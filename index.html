<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="just some note">
<meta property="og:type" content="website">
<meta property="og:title" content="xiake">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="xiake">
<meta property="og:description" content="just some note">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="xiake">
<meta name="twitter:description" content="just some note">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> xiake </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">xiake</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">go go go</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/xuniji2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/22/xuniji2/" itemprop="url">
                  《深入理解Java虚拟机》读书笔记（2）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T15:32:53+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>简单记录一些《深入理解Java虚拟机》的笔记（多数图文都摘自《深入理解Java虚拟机》），供自己查阅和交流学习。</p>
<h4 id="第四章、第五章"><a href="#第四章、第五章" class="headerlink" title="第四章、第五章"></a>第四章、第五章</h4><p>这两章主要讲了JDK自带的虚拟机性能监控工具以及调优实战，很有价值，但不便于记录。主要思想是根据垃圾收集日志来分析虚拟机运行状况，并调节虚拟机参数。</p>
<h4 id="第六章"><a href="#第六章" class="headerlink" title="第六章"></a>第六章</h4><h5 id="一、Class文件结构"><a href="#一、Class文件结构" class="headerlink" title="一、Class文件结构"></a>一、Class文件结构</h5><p>个人理解：Java文件编译后的Class文件是一个描述性的文件，将原本的Java文件中的信息统计并描述出来，虚拟机加载的时候根据这个描述性文件生成Class对象存放在方法区。所以Class文件的结构是虚拟机规定好的，严格并且紧凑。Class文件是一个以8位的字节为单位的二进制流，即最小单位为字节，若遇见需要占用超过8位的数据，则根据高位在前，低位在后的规则每隔8位进行分割开来。根据书中讲解，使用十六进制工具打开class文件，部分内容如下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-b867fcd39e6be691.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Class文件部分内容"></p>
<p>稍微解析几个字节：Class文件开头4个字节总是16进制的CAFEBABE（据说和某咖啡品牌有关），这一文件开头的4个字节的魔术数字（magic），其唯一作用就是使得该文件被识别为Class文件。然后后面跟着4个字节的version，是Class文件的版本。比如此处00 00 00 33，十进制则是51，代表需要JDK1.7以上的环境。后面两个字节则是常量的数量（constant_pool_count），下标从1开始，此处为02AB，其对应的十进制-1就是这个Class文件中常量的个数，下图是Class文件的详细结构：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-79a36ac38de4578d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Class文件结构"></p>
<p>其中，u1、u2、u4、u8分别代表1个字节、2个字节、4个字节、8个字节的无符号数。属于基本数据类型。其他的类似cp_info则是一个复杂数据类型，这个复杂类型内部是一个表，类似于整个Class的结构这样，用于描述cp_info的各项特征。</p>
<p><strong>1、常量池：</strong> 常量池对应上图中的constant_pool，它的容量是前一项constant_pool_count决定的。常量池中有两大类数据：字面量和符号引用。字面量就是文本字符串、常量值等等，而符号引用包括类和接口的全限定名、字段的名称和描述符、方法的名称和描述符。也就是说，Class文件中，只是存储的字段、方法的符号引用并非真正的内存地址。只有在类加载过程的“解析”阶段，才会将符号引用替换为直接引用。</p>
<p>个人理解（欢迎批评指正）：比如说现在在某个类中有一个字段为Z，这个字段Z的类型为类A，那么当解析这个字段Z的时候，会首先解析Z对应的类A。在其常量池中会有一个类型为CONSTANT_Class_info的常量，这个常量是这个类A的符号引用，而这个CONSTANT_Class_info类型当中包括tag和name_index两项。其中name_index会指向一个CONSTANT_Utf8_info类型的常量，这个CONSTANT_Utf8_info类型的常量会存有代表这个类A的符号引用的字符串。这个符号引用在类创建或运行时被解析为真正的内存地址。</p>
<p><strong>2、字段表集合：</strong> 字段表——fields用于描述接口或者类中声明的变量（成员变量）。每一个字段需要一个字段表来进行描述：作用域、可变性、是否可被序列化、实例变量还是类变量等等。这些字段中，可用基本数据类型描述的，就用二进制数表示。而类似于字段名、字段的数据类型这类无法固定的，则引用常量池中的常量。</p>
<p><strong>3、方法表集合：</strong> 方法表——methods与字段表类似，也会有多个标志进行描述。同时还有相应的属性表，方法中的代码就存在于方法属性表集合中一个名为Code的属性里面。</p>
<p>前面简单记录了Class文件的结构，使用16进制文件查看解析自然不便，现在可以使用字节码查看工具或者JDK的javap命令，查看解析好的Class文件(下图与上文的16进制图片并非同一个Class文件)。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-373e7b6a1371bb8d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="javap命令查看字节码文件"></p>
<h5 id="二、字节码指令"><a href="#二、字节码指令" class="headerlink" title="二、字节码指令"></a>二、字节码指令</h5><p>通过javap命令能看见Class文件的方法表的Code属性，这个Code属性包含了可执行的字节码指令，通过阅读这些字节码指令，可以了解方法中的代码执行过程。为了查看字节码指令组成的执行过程，需要熟悉常见的指令，在此记录一些主要的字节码指令。</p>
<p>一般来说，每个字节码指令有数据类型作为前缀，比如：i代表对int类型的数据操作，l代表long，s代表short，b代表byte，c代表char，f代表float，d代表double，a代表reference。为了控制字节码指令的数量，并非每个字节码指令都支持所有的数据类型。</p>
<p>比如：大部分的指令都没有支持整数类型byte、 char和short，甚至没有任何指令支持boolean类型。 编译器会在编译期或运行期将byte和short类型的数据带符号扩展（Sign-Extend）为相应的int类型数据，将boolean和char类型数据零位扩展（ZeroExtend）为相应的int类型数据。 与之类似，在处理boolean、 byte、 short和char类型的数组时，也会转换为使用对应的int类型的字节码指令来处理。 因此，大多数对于boolean、 byte、 short和char类型数据的操作，实际上都是使用相应的int类型作为运算类型。</p>
<p>T代表数据类型的简写：</p>
<blockquote>
<p><strong>加载和存储指令：</strong><br>Tload：将一个局部变量加载到操作栈（局部变量表和操作栈均在虚拟机栈的每个栈帧中）<br>Tstore：将一个数值从操作数栈存储到局部变量表<br>Tipush：将一个常量加载到操作数栈<br>Taload：将一个数组元素加载到操作数栈<br>Tastore：将一个操作数栈的值存储到数组元素中</p>
<p><strong>运算指令：</strong><br>Tadd：加法<br>Tsub：减法<br>Tmul：乘法<br>Tdiv：除法<br>Trem：求余<br>Tneg：取反<br>Tshl、Tshr：位移<br>Tor：按位或<br>Tand：按位与<br>Txor：按位异或<br>iinc：局部变量自增<br>Tcmpg、Tcmpl：比较</p>
<p><strong>类型转换指令（窄化类型转换）：</strong><br>i2b、 i2c、 i2s、 l2i、 f2i、 f2l、 d2i、 d2l和d2f</p>
<p><strong>对象创建与访问指令：</strong><br>创建类实例的指令：new。<br>创建数组的指令：newarray、 anewarray、 multianewarray。<br>访问类字段（static字段，或者称为类变量）和实例字段（非static字段，或者称为实例变量）的指令：getfield、 putfield、 getstatic、 putstatic。<br>取数组长度的指令：arraylength。<br>检查类实例类型的指令：instanceof、 checkcas</p>
<p><strong>操作数栈管理指令：</strong><br>将操作数栈的栈顶一个或两个元素出栈：pop、 pop2。<br>复制栈顶一个或两个数值并将复制值或双份的复制值重新压入栈顶：dup、 dup2、dup_x1、 dup2_x1、 dup_x2、 dup2_x2。<br>将栈最顶端的两个数值互换：swap。</p>
<p><strong>控制转移指令：</strong><br>条件分支：ifeq、 iflt、 ifle、 ifne、 ifgt、 ifge、 ifnull、 ifnonnull、if_icmpeq、 if_icmpne、if_icmplt、 if_icmpgt、 if_icmple、if_icmpge、 if_acmpeq和if_acmpne。<br>复合条件分支：tableswitch、 lookupswitch。<br>无条件分支：goto、 goto_w、 jsr、 jsr_w、 ret。</p>
<p><strong>方法调用和返回指令：</strong><br>invokevirtual指令用于调用对象的实例方法，根据对象的实际类型进行分派（虚方法分派）<br>invokeinterface指令用于调用接口方法，它会在运行时搜索一个实现了这个接口方法的对象，找出适合的方法进行调用。<br>invokespecial指令用于调用一些需要特殊处理的实例方法，包括实例初始化方法、 私有方法和父类方法。<br>invokestatic指令用于调用类方法（static方法）。invokedynamic指令用于在运行时动态解析出调用点限定符所引用的方法，并执行该方法，前面4条调用指令的分派逻辑都固化在Java虚拟机内部，而&gt;invokedynamic指令的分派逻辑是由用户所设定的引导方法决定的。</p>
<p><strong>同步指令（synchronized）：</strong><br>monitorenter和monitorexit两条指令来支持synchronized关键字的语义，正确实现synchronized关键字需要Javac编译器与Java虚拟机两者共同协作支持</p>
</blockquote>
<h4 id="第七章"><a href="#第七章" class="headerlink" title="第七章"></a>第七章</h4><p>这一章主要讲了类加载过程，详细的过程大致分为加载、验证、准备、初始化、使用、卸载几步。</p>
<h5 id="一、类加载过程"><a href="#一、类加载过程" class="headerlink" title="一、类加载过程"></a>一、类加载过程</h5><h6 id="1、加载"><a href="#1、加载" class="headerlink" title="1、加载"></a>1、加载</h6><p>类加载过程主要是三件事：<br>1）通过类的全限定名来获取定义此类的二进制字节流（比如从Class文件读取）<br>2）将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构<br>3）在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问入口。在Hotspot虚拟机中，这个Class对象是存放在方法区的。</p>
<h6 id="2、验证"><a href="#2、验证" class="headerlink" title="2、验证"></a>2、验证</h6><p>为了虚拟机的安全，这一步主要是验证读取的字节流是否符合虚拟机的约束。包括文件格式、语义分析、字节码指令验证、符号引用验证等等，在这个阶段不通过，通常就会抛出异常。比如如果某个符号引用对应的类的方法不存在，就会抛出java.lang.NoSuchMethodError异常</p>
<h6 id="3、准备"><a href="#3、准备" class="headerlink" title="3、准备"></a>3、准备</h6><p>准备阶段是正式为类变量分配内存并设置类变量初始值的阶段，这些变量所使用的内存都将在方法区中进行分配。 这个阶段中有两个容易产生混淆的概念需要强调一下，首先，这时候进行内存分配的仅包括类变量（被static修饰的变量），而不包括实例变量，实例变量将会在对象实例化时随着对象一起分配在Java堆中。 其次，这里所说的初始值“通常情况”下是数据类型的零值。</p>
<h6 id="4、解析"><a href="#4、解析" class="headerlink" title="4、解析"></a>4、解析</h6><p>解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程，解析动作主要针对类或接口、 字段、 类方法、 接口方法、 方法类型、 方法句柄和调用点限定符7类符号引用进行，分别对应于常量池的CONSTANT_Class_info、CONSTANT_Fieldref_info、CONSTANT_Methodref_info、CONSTANT_InterfaceMethodref_info、CONSTANT_MethodType_info、CONSTANT_MethodHandle_info和CONSTANT_InvokeDynamic_info 7种常量类型</p>
<h6 id="5、类的初始化"><a href="#5、类的初始化" class="headerlink" title="5、类的初始化"></a>5、类的初始化</h6><p>类初始化阶段是类加载过程的最后一步，前面的类加载过程中，除了在加载阶段用户应用程序可以通过自定义类加载器参与之外，其余动作完全由虚拟机主导和控制。 到了初始化阶段，才真正开始执行类中定义的Java程序代码。</p>
<p><strong>有且只有以下五种情况会触发类初始化：</strong><br>1）遇到new、 getstatic、 putstatic或invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。 生成这4条指令的最常见的Java代码场景是：使用new关键字实例化对象的时候、 读取或设置一个类的静态字段（被final修饰、 已在编译期把结果放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。<br>2）使用java.lang.reflect包的方法对类进行反射调用的时候，如果类没有进行过初始化，则需要先触发其初始化。<br>3）当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。<br>4）当虚拟机启动时，用户需要指定一个要执行的主类（包含main（）方法的那个类），虚拟机会先初始化这个主类。<br>5）当使用JDK 1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果REF_getStatic、REF_putStatic、 REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发其初始化</p>
<p><strong>特别需要注意的：</strong><br>1）通过其子类来引用父类中定义的静态字段，只会触发父类的初始化而不会触发子类的初始化。比如父类A中有字段a，B继承了A，而B中没有a字段。调用B.a，不会触发B的初始化。<br>2）通过数组定义来引用类，不会触发此类的初始化。比如:A[] simple = new A[10]，不会触发A的初始化。<br>3）常量在编译阶段会存入调用类的常量池中，本质上并没有直接引用到定义常量的类，因此不会触发定义常量的类的初始化。</p>
<p>初始化阶段是执行类构造器＜clinit＞()方法的过程，＜clinit＞()方法是有编译器自动收集类中所有类变量的赋值动作和static{}块中的语句合并产生的。编译器收集的顺序是由语句在源文件中出现的顺序所决定的，静态语句块中只能访问到定义在静态语句块之前的变量，定义在它之后的变量，在前面的静态语句块可以赋值，但是不能访问。</p>
<p>虚拟机会保证在子类的＜clinit＞()方法执行之前，父类的＜clinit＞()方法已经执行完毕。 因此在虚拟机中第一个被执行的＜clinit＞()方法的类肯定是java.lang.Object。由于父类的＜clinit＞()方法先执行，也就意味着父类中定义的静态语句块要优先于子类的变量赋值操作。</p>
<p>接口中不能使用静态语句块，但仍然有变量初始化的赋值操作，因此接口与类一样都会生成＜clinit＞()方法。 但接口与类不同的是，执行接口的＜clinit＞()方法不需要先执行父接口的＜clinit＞()方法。 只有当父接口中定义的变量使用时，父接口才会初始化。 另外，接口的实现类在初始化时也一样不会执行接口的＜clinit＞()方法。</p>
<p>虚拟机会保证一个类的＜clinit＞()方法在多线程环境中被正确地加锁、同步。如果有多个线程同时初始化一个类，那么只会有一个线程去执行＜clinit＞()方法。</p>
<h5 id="二、类加载器"><a href="#二、类加载器" class="headerlink" title="二、类加载器"></a>二、类加载器</h5><h6 id="1、类与类加载器的关系"><a href="#1、类与类加载器的关系" class="headerlink" title="1、类与类加载器的关系"></a>1、类与类加载器的关系</h6><p>在虚拟机中，要区分两个类是否相等，需要“类Class文件”+“加载这个类的类加载器”都相等。即这两个类来源于同一个Class文件，并且被同一个类加载器加载，这两个类才相等。这里所指的“相等”，包括代表类的Class对象的equals（）方法、 isAssignableFrom（）方法、 isInstance（）方法的返回结果，也包括使用instanceof关键字做对象所属关系判定等情况。</p>
<h6 id="2、双亲委托机制"><a href="#2、双亲委托机制" class="headerlink" title="2、双亲委托机制"></a>2、双亲委托机制</h6><p>对于虚拟机来说，类加载器只有两种：虚拟机自带的启动类加载器和其他用Java语言实现的类加载器。<br>对于开发人员来说，可以更详细一点，分为三类：<br>1）启动类加载器（Bootstrap ClassLoader）：这个类将器负责将存放在＜JAVA_HOME＞\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的，并且是虚拟机识别的（仅按照文件名识别，如rt.jar，名字不符合的类库即使放在lib目录中也不会被加载）类库加载到虚拟机内存中。 启动类加载器无法被Java程序直接引用。但是可以通过委托机制将加载请求委派给引导类加载器（实现自己的类加载器在本文不详细讨论）。<br>2）扩展类加载器（Extension ClassLoader）：这个加载器由sun.misc.Launcher$ExtClassLoader实现，它负责加载&lt;JAVA_HOME＞\lib\ext目录中的，或者被java.ext.dirs系统变量所指定的路径中的所有类库，开发者可以直接使用扩展类加载器。<br>3）应用程序类加载器（Application ClassLoader）：这个类加载器由sun.misc.Launcher$AppClassLoader实现。 由于这个类加载器是ClassLoader中的getSystemClassLoader（）方法的返回值，所以一般也称它为系统类加载器。 它负责加载用户类路径（ClassPath）上所指定的类库，开发者可以直接使用这个类加载器，如果应用程序中没有自定义过自己的类加载器，一般情况下这个就是程序中默认的类加载器。</p>
<p>Java设计者推荐开发者在实现类加载器的时候遵从双亲委托机制，即除了启动类加载器以外，其他的类加载器都应该有自己的父类加载器。但是这里的父子关系一般不会以继承来实现，而是使用组合。示意图如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-381fdbfca6bc2c20.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="双亲委托机制示意图"></p>
<p>双亲委托机制的工作过程：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器去完成，每一个层次的类加载器都是如此，因此所有的加载请求最终都应该传送到顶层的启动类加载器中，只有当父加载器反馈自己无法完成这个加载请求（它的搜索范围中没有找到所需的类）时，子加载器才会尝试自己去加载。</p>
<p>为什么要使用双亲委托机制呢？使用这种模型来组织类加载器之间的关系，有一个显而易见的好处就是Java类随着它的类加载器一起具备了一种带有优先级的层次关系。 例如类java.lang.Object，它存放在rt.jar之中，无论哪一个类加载器要加载这个类，最终都是委派给处于模型最顶端的启动类加载器进行加载，因此Object类在程序的各种类加载器环境中都是同一个类。 相反，如果没有使用双亲委派模型，由各个类加载器自行去加载的话，如果用户自己编写了一个称为java.lang.Object的类，并放在程序的ClassPath中，那系统中将会出现多个不同的Object类，Java类型体系中最基础的行为也就无法保证，应用程序也将会变得一片混乱。 </p>
<p>实现双亲委派的代码都集中在java.lang.ClassLoader的loadClass()方法之中，逻辑清晰易懂：先检查是否已经被加载过，若没有加载则调用父加载器的loadClass()方法，若父加载器为空则默认使用启动类加载器作为父加载器。 如果父类加载失败，抛出ClassNotFoundException异常后，再调用自己的findClass()方法进行加载。</p>
<h6 id="3、线程上下文类加载器"><a href="#3、线程上下文类加载器" class="headerlink" title="3、线程上下文类加载器"></a>3、线程上下文类加载器</h6><p>因为有了双亲委托机制，那么使得类带有了层次关系。但是也有不便的地方。如果一个接口A使用了启动类加载器去加载，而类B实现了接口A并且使用了自定义的加载器，那么在向上造型的时候必然会失败，因为A和B使用了不同的类加载器，导致类型不一致。如果启动类加载器能够加载类B，那直接使得A和B使用同一个类加载器也没有问题。但是事实是现有很多组件，是由JDK定义一套接口（这套接口由启动类加载器加载），而具体的实现是由第三方书写的。如此一来，启动类加载器只认识JDK中虚拟机识别的路径下的类，第三方的类是不能被启动类加载器所加载的，便出现了类型转换的问题。</p>
<p>因此Java设计团队引入了线程上下文加载器（Thread Context ClassLoader），这个类加载器可以通过java.lang.Thread类的<br>setContextClassLoaser()方法进行设置，如果创建线程时还未设置，它将会从父线程中继承一个，如果在应用程序的全局范围内都没有设置过的话，那这个类加载器默认就是应用程序类加载器。</p>
<p>有了线程上下文加载器，便可以解决上述类型问题。上文中这套由JDK定义的接口，不再使用启动类加载器加载，而是由启动类加载器请求线程上下文加载器去加载。一般的，线程上下文加载器是应用程序类加载器，那么使得这套JDK定义的接口可以使用应用程序类加载器加载。而第三方的实现默认也是应用程序类加载器加载，这样一来，接口和实现类的类加载器就统一了，解决了类型转换问题。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/19/xuniji1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/19/xuniji1/" itemprop="url">
                  《深入理解Java虚拟机》读书笔记（1）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-19T14:36:53+08:00">
                2017-08-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>简单记录一些《深入理解Java虚拟机》的笔记（基本所有图和话都摘自《深入理解Java虚拟机》）</p>
<h4 id="第二章"><a href="#第二章" class="headerlink" title="第二章"></a>第二章</h4><h5 id="1、虚拟机运行时结构"><a href="#1、虚拟机运行时结构" class="headerlink" title="1、虚拟机运行时结构"></a>1、虚拟机运行时结构</h5><p><img src="http://upload-images.jianshu.io/upload_images/3727888-4ba5fd8db8146b96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="虚拟机运行时结构"></p>
<p><strong>程序计数器：</strong>可看做当前线程所执行的字节码的行号指示器。</p>
<p><strong>虚拟机栈：</strong>描述java方法执行的内存模型。每个方法在执行的同时都会创建一个栈帧（ Stack Frame） 用于存储局部变量表、 操作数栈、 动态链接、 方法出口等信息。 其中局部变量表（主要关注点）存放了编译期可知的基本数据类型、对象引用和returnAddress类型（ 指向了 一条字节码指令的地址）。</p>
<p><strong>本地方法栈：</strong>与虚拟机栈作用类似，它们之间的区别不过是虚拟机栈为虚拟机执行Java方法（ 也就是字节码） 服务， 而本地方法栈则为虚拟机使用到的Native方法服务。有的虚拟机（ 如Sun HotSpot虚拟机） 直接就把本地方法栈和虚拟机栈合二为一。 </p>
<p><strong>Java堆：</strong>虚拟机启动时创建，存储对象实例，垃圾收集器管理的主要区域。Java堆中还可以细分为： 新生代和老年代； 新生代中再细致一点的有Eden空间、 From Survivor空间、 To Survivor空间。</p>
<p><strong>方法区：</strong>用于存储已被虚拟机加载的类信息、 常量、 静态变量、 即时编译器编译后的代码等数据。 运行时常量池（ Runtime Constant Pool） 是方法区的一部分。String.intern() 是一个Native方法， 它的作用是： 如果字符串常量池中已经包含一个等于此String对象的字符串， 则返回代表池中这个字符串的String对象； 否则， 将此String对象包含的字符串添加到常量池中， 并且返回此String对象的引用。</p>
<p><strong>本机直接内存：</strong>不是虚拟机运行时数据区的一部分， 也不是Java虚拟机规范中定义的内存区域。NIO（ New Input/Output） 类， 引入了 一种基于通道（ Channel） 与缓冲区（ Buffer） 的I/O方式， 它可以使用 Native函数库直接分配堆外内存， 然后通过一个存储在Java堆中的DirectByteBuffer对象作为这块内存的引用进行操作。 这样能在一些场景中显著提高性能， 因为避免了 在Java堆和Native堆中来回复制数据。默认与堆最大值“-Xmx”相同。</p>
<h4 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h4><h5 id="1、三种垃圾回收算法"><a href="#1、三种垃圾回收算法" class="headerlink" title="1、三种垃圾回收算法"></a>1、三种垃圾回收算法</h5><p><strong>A、标记-清除算法</strong></p>
<p>标记-清除算法分为 “标记”和“清除”两个阶段： 首先标记出所有需要回收的对象， 在标记完成后统一回收所有被标记的对象。它的主要不足有两个： 一个是效率问题， 标记和清除两个过程的效率都不高； 另一个是空间问题， 标记清除之后会产生大量不连续的内存碎片， 空间碎片太多可能会导致以后在程序运行过程中需要分配较大对象时， 无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作。 </p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-a1fba6f4597bc9c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标记-清除算法示意图"></p>
<p><strong>B、复制算法</strong></p>
<p>将可用内存按容量划分为大小相等的两块， 每次只使用其中的一块。 当这一块的内存用完了 ， 就将还存活着的对象复制到另外一块上面， 然后再把已使用过的内存空间一次清理掉。 这样使得每次都是对整个半区进行内存回收， 内存分配时也就不用考虑内存碎片等复杂情况， 只要移动堆顶指针， 按顺序分配内存即可， 实现简单， 运行高效。 只是这种算法的代价是将内存缩小为了 原来的一半， 未免太高了 一点。</p>
<p>但现在的商业虚拟机都采用这种收集算法来回收新生代， IBM公司的专门研究表明， 新生代中的对象98%是“朝生夕死”的， 所以并不需要按照1:1的比例来划分内存空间， 而是将内存分为一块较大的Eden空间和两块较小的Survivor空间， 每次使用 Eden和其中一块Survivor。当回收时， 将Eden和Survivor中还存活着的对象一次性地复制到另外一块Survivor空间上， 最后清理掉Eden和刚才用过的Survivor空间。 HotSpot虚拟机默认Eden和Survivor的大小比例是8:1， 也就是每次新生代中可用内存空间为整个新生代容量的90%（ 80%+10%） ， 只有10%的内存会被“浪费”。 当然， 98%的对象可回收只是一般场景下的数据， 我们没有办法保证每次回收都只有不多于10%的对象存活， 如果另外一块Survivor空间没有足够空间存放上一次新生代收集下来的存活对象时，这些对象将直接通过分配担保机制进入老年代。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-1b21aca79a74d4c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="复制算法示意图"></p>
<p><strong>C、标记整理算法</strong><br>标记整理算法的标记过程仍然与“标记-清除”算法一样， 但后续步骤不是直接对可回收对象进行清理， 而是让所有存活的对象都向一端移动， 然后直接清理掉端边界以外的内存。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-8aba428d138444d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="标记整理算法示意图"></p>
<p><strong>结论</strong><br>以上三种算法各有优缺点，所以在实际应用中，形成了现在的“分代收集算法”，根据对象存活周期的不同将内存划分为几块。 一般是把Java堆分为新生代和老年代， 这样就可以根据各个年代的特点采用最适当的收集算法。 在新生代中， 每次垃圾收集时都发现有大批对象死去， 只有少量存活， 那就选用复制算法， 只需要付出少量存活对象的复制成本就可以完成收集。 而老年代中因为对象存活率高、 没有额外空间对它进行分配担保， 就必须使用 “标记—清理”或者“标记—整理”算法来进行回收。</p>
<h5 id="2、垃圾收集器"><a href="#2、垃圾收集器" class="headerlink" title="2、垃圾收集器"></a>2、垃圾收集器</h5><p>JDK 1.7 Update 14（及以后的版本）包含了7个收集器。对于垃圾收集器的总结，粗略如下图。图中STW=StopThe World，即暂停所有工作线程。并行是指有多个线程进行垃圾收集。而并发是指垃圾收集的线程和工作线程同时运行。两个收集器中的连线是代表这两个收集器可以组合使用（开启参数见下方附录）。</p>
<p><img src="http://ouws94yej.bkt.clouddn.com/xunijilajishoujiqi.png" alt="多种垃圾收集器示意图"></p>
<p>CMS（Concurrent Mark Sweep）收集器和G1（Garbage-First）收集器拥有了并发能力，所以整个收集过程比其余收集器复杂一些，标记过程分为多个阶段，特别记录一下。</p>
<p>CMS收集器运行示意图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-61e398f4eceb2130.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="CMS收集器运行示意图"></p>
<p>G1收集器运行示意图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-9f1a3b62e10742cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="G1收集器运行示意图"></p>
<h4 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h4><p>记录下从书中了解的一些常见虚拟机配置参数，便于查阅：</p>
<h6 id="1-配置调整类型参数"><a href="#1-配置调整类型参数" class="headerlink" title="1. 配置调整类型参数"></a>1. 配置调整类型参数</h6><table>
<thead>
<tr>
<th style="text-align:center">参数名</th>
<th style="text-align:center">意义</th>
<th style="text-align:center">示例</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-Xms</td>
<td style="text-align:center">堆的最小值</td>
<td style="text-align:center">-Xms512M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-Xmx</td>
<td style="text-align:center">堆的最大值</td>
<td style="text-align:center">-Xmx1024M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-Xmn</td>
<td style="text-align:center">年轻代大小</td>
<td style="text-align:center">-Xmn100M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-Xss</td>
<td style="text-align:center">栈内存大小</td>
<td style="text-align:center">-Xss100M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-Xoss</td>
<td style="text-align:center">本地方法栈大小</td>
<td style="text-align:center">-Xoss100M</td>
<td style="text-align:center">对于HotSpot无效</td>
</tr>
<tr>
<td style="text-align:center">-XX:PermSize</td>
<td style="text-align:center">方法区大小</td>
<td style="text-align:center">-XX:PermSize=128M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-XX:MaxPermSize</td>
<td style="text-align:center">方法区最大容量</td>
<td style="text-align:center">-XX:MaxPermSize=256M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-XX:MaxDirectMemorySize</td>
<td style="text-align:center">本机直接内存容量</td>
<td style="text-align:center">-XX:MaxDirectMemorySize =256M</td>
<td style="text-align:center">单位：M（m）</td>
</tr>
<tr>
<td style="text-align:center">-XX:SurvivorRatio</td>
<td style="text-align:center">新生代中Eden和survivor的比例</td>
<td style="text-align:center">-XX:SurvivorRatio=8</td>
<td style="text-align:center">默认为8</td>
</tr>
<tr>
<td style="text-align:center">-XX:ParallelGCThreads</td>
<td style="text-align:center">并行GC时进行内存回收的线程数</td>
<td style="text-align:center">-XX:ParallelGCThreads=43</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:PretenureSizeThreshold</td>
<td style="text-align:center">直接晋升老年代的对象大小</td>
<td style="text-align:center">-XX:PretenureSizeThreshold=3145728</td>
<td style="text-align:center">单位：字节</td>
</tr>
<tr>
<td style="text-align:center">-XX:MaxTenuringThreshold</td>
<td style="text-align:center">晋升到老年代的对象年龄</td>
<td style="text-align:center">-XX:MaxTenuringThreshold=1</td>
<td style="text-align:center">每经过一次GC，年龄+1</td>
</tr>
<tr>
<td style="text-align:center">-XX:GCTimeRatio</td>
<td style="text-align:center">GC时间占总时间的比率</td>
<td style="text-align:center">-XX:GCTimeRatio=99</td>
<td style="text-align:center">默认值为99，即允许1%的GC时间，仅对Parallel Scavenge 生效</td>
</tr>
<tr>
<td style="text-align:center">-XX:MaxGCPauseMillis</td>
<td style="text-align:center">设置GC的最大停顿时间</td>
<td style="text-align:center">-XX:MaxGCPauseMillis</td>
<td style="text-align:center">仅对Parallel Scavenge 生效,单位：毫秒</td>
</tr>
<tr>
<td style="text-align:center">-XX:CMSInitiatingOccupancyFraction</td>
<td style="text-align:center">设置老年代空间被使用多少后触发垃圾回收（百分比）</td>
<td style="text-align:center">-XX:CMSInitiatingOccupancyFraction=85</td>
<td style="text-align:center">仅对CMS收集器有效</td>
</tr>
<tr>
<td style="text-align:center">-XX:CMSFullGCsBeforeCompaction</td>
<td style="text-align:center">设置在进行若干次垃圾收集后再启动一次内存碎片整理</td>
<td style="text-align:center">-XX:CMSFullGCsBeforeCompaction=0</td>
<td style="text-align:center">仅对CMS有效,默认值为0</td>
</tr>
</tbody>
</table>
<h6 id="2-开关类型的参数："><a href="#2-开关类型的参数：" class="headerlink" title="2. 开关类型的参数："></a>2. 开关类型的参数：</h6><table>
<thead>
<tr>
<th style="text-align:center">参数名</th>
<th style="text-align:center">意义</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-XX:+HeapDumpOnOutOfMemoryError</td>
<td style="text-align:center">让虚拟机在出现内存溢出时Dump出当前的内存堆转储快照</td>
<td style="text-align:center">快照可用诸如Eclipse Memory Analyzer这类工具对快照进行分析</td>
</tr>
<tr>
<td style="text-align:center">-Xnoclassgc</td>
<td style="text-align:center">控制是否对类进行回收</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX: +PrintGCDetails</td>
<td style="text-align:center">收集GC日志</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+TraceClassLoading</td>
<td style="text-align:center">查看类加载信息</td>
<td style="text-align:center">Product版的虚拟机*</td>
</tr>
<tr>
<td style="text-align:center">-XX:+TraceClassLoading</td>
<td style="text-align:center">查看类卸载信息</td>
<td style="text-align:center">FastDebug版的虚拟机*</td>
</tr>
<tr>
<td style="text-align:center">-XX:+UseSerialGC</td>
<td style="text-align:center">使用Serial+Serial Old的收集器组合进行内存回收</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+UserParNewGC</td>
<td style="text-align:center">使用ParNew+Serial Old的收集器组合进行内存回收</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+UseConcMarkSweepGC</td>
<td style="text-align:center">使用ParNew+CMS+Serial Old的收集器组合进行内存回收</td>
<td style="text-align:center">此时Serial Old作为CMS的后备收集器</td>
</tr>
<tr>
<td style="text-align:center">-XX:+UseParallelGC</td>
<td style="text-align:center">使用Parallel Scavenge+Serial Old的收集器组合进行内存回收</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+UseParallelOldGC</td>
<td style="text-align:center">使用Parallel Scavenge+Parallel Old的收集器组合进行内存回收</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+UseAdaptiveSizePolicy</td>
<td style="text-align:center">动态调整Java堆中各个区域的大小以及进入老年代的年龄</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+HandlePromotionFailure</td>
<td style="text-align:center">是否允许分配担保失败</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">-XX:+UseCMSCompactAtFullCollection</td>
<td style="text-align:center">设置完成垃圾收集后是否要进行一次内存碎片整理</td>
<td style="text-align:center">仅对CMS有效</td>
</tr>
</tbody>
</table>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/14/SOAP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/14/SOAP/" itemprop="url">
                  基于SOAP的webservice（1）、JAX-WS实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-14T23:25:31+08:00">
                2017-05-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>因为工作中使用了SOAP进行两个系统的接口调用，所以私下学习一下两种实现，粗略记录于此。本文侧重于实际实现操作，而不是理论原理。</li>
<li>个人简单理解：SOAP（Simple Object Access Protocol 简单对象访问协议）是基于<strong>XML</strong>和<strong>HTTP</strong>的用于实现网络连通的程序之间远程调用的协议(但是SOAP1.2中也可以使用非HTTP协议进行传输)。两个通过网络连接的程序体，通过一定规范的XML进行远程调用。更详细一点的可以参考<a href="https://www.ibm.com/developerworks/cn/xml/x-sisoap/" target="_blank" rel="external">浅谈 SOAP</a>。</li>
</ul>
<h3 id="方式1、JAX-WS实现"><a href="#方式1、JAX-WS实现" class="headerlink" title="方式1、JAX-WS实现"></a>方式1、JAX-WS实现</h3><p>JAX-WS是JDK自带的Web服务的API，它可以用于提供REST式或基于SOAP的服务。SOAP的JAX-WS实现有两种部署方式，一种是直接在应用程序中使用Endpoint发布；另一种是在web工程的web.xml中配置监听器，随着web工程的启动而启动。为了两种方式都使用，并且便于使用依赖，我这里创建的是一个maven web工程，工程名为SOAPServer，JDK版本是1.8。</p>
<h4 id="1-编写服务端。"><a href="#1-编写服务端。" class="headerlink" title="1. 编写服务端。"></a>1. 编写服务端。</h4><p>用于提供服务的服务端类ServerDemo ：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> demo;</div><div class="line"><span class="keyword">import</span> javax.jws.WebMethod;</div><div class="line"><span class="keyword">import</span> javax.jws.WebService;</div><div class="line"></div><div class="line"><span class="meta">@WebService</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerDemo</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@WebMethod</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">sayHi</span><span class="params">(String name)</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"Hi: "</span>+name+<span class="string">",this is SOAPServer"</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@WebMethod</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">doSth</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">"do some thing"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个类很简单，只有两个方法，一个有参数，一个无参数。类名前面加了@WebService注解，方法名前面加了@WebMethod注解（SOAP还有许多其他的注解）。</p>
<h4 id="2-发布服务。"><a href="#2-发布服务。" class="headerlink" title="2. 发布服务。"></a>2. 发布服务。</h4><p>前面提到发布服务有两种方式。</p>
<h5 id="（1）、使用Endpoint发布，编写用于发布的类："><a href="#（1）、使用Endpoint发布，编写用于发布的类：" class="headerlink" title="（1）、使用Endpoint发布，编写用于发布的类："></a>（1）、使用Endpoint发布，编写用于发布的类：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> demo;</div><div class="line"><span class="keyword">import</span> javax.xml.ws.Endpoint;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Publisher</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		String url = <span class="string">"http://localhost:8080/fistSoap"</span>;</div><div class="line">		Endpoint.publish(url, <span class="keyword">new</span> ServerDemo());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行main方法，使用浏览器访问<a href="http://localhost:8080/fistSoap，" target="_blank" rel="external">http://localhost:8080/fistSoap，</a> 如果有如下所示，即说明发布正常。 <img src="http://upload-images.jianshu.io/upload_images/3727888-86b0a48176c5fef5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="访问服务">  </p>
<h5 id="（2）、使用web项目监听器发布。"><a href="#（2）、使用web项目监听器发布。" class="headerlink" title="（2）、使用web项目监听器发布。"></a>（2）、使用web项目监听器发布。</h5><p>  首先需要添加依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.ws<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxws-rt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后在WEB-INFO目录下添加名为sun-jaxws.xml（默认名称）的文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">endpoints</span> <span class="attr">version</span>=<span class="string">"2.0"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/jax-ws/ri/runtime"</span>&gt;</span>  </div><div class="line">  </div><div class="line">  <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">name</span>=<span class="string">"firstSoap"</span> <span class="attr">implementation</span>=<span class="string">"demo.ServerDemo"</span> <span class="attr">url-pattern</span>=<span class="string">"/firstSoap"</span>&gt;</span><span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">endpoints</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后在web.xml中添加监听器和servlet(此处url-pattern为/*，拦截所有请求)：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   <span class="tag">&lt;<span class="name">listener</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.sun.xml.ws.transport.http.servlet.WSServletContextListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span> </div><div class="line">   <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">   	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jaxws<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">   	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.sun.xml.ws.transport.http.servlet.WSServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">   	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">   	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jaxws<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">   	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>然后在浏览器中访问<a href="http://localhost:8080/SOAPServer/firstSoap，" target="_blank" rel="external">http://localhost:8080/SOAPServer/firstSoap，</a> 出现与Endpoint方式一样的web服务的概述页面，说明发布正常。如果有多个服务，那么只需要在sun-jaxws.xml中增加一条endpoint即可。例如我在sun-jaxws.xml增加了一个如下服务，那么我访问<a href="http://localhost:8080/SOAPServer/firstSoap或者" target="_blank" rel="external">http://localhost:8080/SOAPServer/firstSoap或者</a> <a href="http://localhost:8080/SOAPServer/randService" target="_blank" rel="external">http://localhost:8080/SOAPServer/randService</a> 会显示两个服务的信息。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">endpoints</span> <span class="attr">version</span>=<span class="string">"2.0"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/jax-ws/ri/runtime"</span>&gt;</span>  </div><div class="line">  </div><div class="line">  <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">name</span>=<span class="string">"firstSoap"</span> <span class="attr">implementation</span>=<span class="string">"demo.ServerDemo"</span> <span class="attr">url-pattern</span>=<span class="string">"/firstSoap"</span>&gt;</span><span class="tag">&lt;/<span class="name">endpoint</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">endpoint</span> <span class="attr">name</span>=<span class="string">"RandService"</span> <span class="attr">implementation</span>=<span class="string">"rand.RandService"</span> <span class="attr">url-pattern</span>=<span class="string">"/randService"</span> /&gt;</span>  </div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">endpoints</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-706c231575c833bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="多个服务信息"></p>
<h4 id="3-生成客户端代码并调用。"><a href="#3-生成客户端代码并调用。" class="headerlink" title="3. 生成客户端代码并调用。"></a>3. 生成客户端代码并调用。</h4><p>服务发布后使用浏览器访问<a href="http://localhost:8080/SOAPServer/hello?wsdl" target="_blank" rel="external">http://localhost:8080/SOAPServer/hello?wsdl</a> 即可获得该服务的wsdl文档——描述服务调用信息（wsdl文档的详细结构在后续结合XML报文格式进行分析）：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">	<span class="tag">&lt;<span class="name">definitions</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsu</span>=<span class="string">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsp</span>=<span class="string">"http://www.w3.org/ns/ws-policy"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsp1_2</span>=<span class="string">"http://schemas.xmlsoap.org/ws/2004/09/policy"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsam</span>=<span class="string">"http://www.w3.org/2007/05/addressing/metadata"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:soap</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/soap/"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:tns</span>=<span class="string">"http://demo/"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/"</span> <span class="attr">targetNamespace</span>=<span class="string">"http://demo/"</span> <span class="attr">name</span>=<span class="string">"ServerDemoService"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">types</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xsd:schema</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">"http://demo/"</span> <span class="attr">schemaLocation</span>=<span class="string">"http://localhost:8080/SOAPServer/firstSoap?xsd=1"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">types</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHiResponse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHiResponse"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"doSthResponse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">portType</span> <span class="attr">name</span>=<span class="string">"ServerDemo"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/sayHiRequest"</span> <span class="attr">message</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/sayHiResponse"</span> <span class="attr">message</span>=<span class="string">"tns:sayHiResponse"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/doSthRequest"</span> <span class="attr">message</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/doSthResponse"</span> <span class="attr">message</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">portType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">"ServerDemoPortBinding"</span> <span class="attr">type</span>=<span class="string">"tns:ServerDemo"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">soap:binding</span> <span class="attr">transport</span>=<span class="string">"http://schemas.xmlsoap.org/soap/http"</span> <span class="attr">style</span>=<span class="string">"document"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">binding</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"ServerDemoService"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">port</span> <span class="attr">name</span>=<span class="string">"ServerDemoPort"</span> <span class="attr">binding</span>=<span class="string">"tns:ServerDemoPortBinding"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:address</span> <span class="attr">location</span>=<span class="string">"http://localhost:8080/SOAPServer/firstSoap"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">port</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">service</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>获取到wsdl文档之后，我们使用JDK自带的wsimport实用程序来生成客户端代码。（与之相反的是，wsgen实用程序可以通过服务端代码来生成wsdl文件，wsgen和wsimport命令详解可参考<a href="http://blog.csdn.net/yuguiyang1990/article/details/9003383" target="_blank" rel="external"><a href="http://blog.csdn.net/yuguiyang1990/article/details/9003383" target="_blank" rel="external">wsgen和wsimport命令讲解</a></a>）<br>在本例中使用的是windows系统，打开CMD，输入<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wsimport -s D:\work_eclipse\SOAPClient\src\main\java -p my.client http://localhost:8080/SOAPServer/firstSoap?wsdl</div></pre></td></tr></table></figure></p>
<p>即在D盘work_eclipse\SOAPClient\src\main\java目录下的my.client目录中生成了客户端代码（工程SOAPClient是新建的用来调用SOAPServer的工程），目录如图所示：<br><img src="http://upload-images.jianshu.io/upload_images/3727888-4d2ff98e7b88713a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="根据wsdl文件生成的客户端代码（client包下）"><br>在服务端代码中，ServerDemo服务类，对应客户端中生成的ServerDemo接口和ServerDemoService类；服务类中的方法sayHi()对应客户端代码中的SayHi和SayHiResponse实体类；服务类中的方法doSth()对应客户端代码中的DoSth和DoSthResponse实体类。客户端中还生成了ObjectFactory类和package-info类。此处先不关心生成的类的结构，先尝试进行调用（当然，此时要保证SOAP服务处于已发布的状态）。</p>
<p>在SOAPclient的call目录下创建调用类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> call;</div><div class="line"></div><div class="line"><span class="keyword">import</span> my.client.ServerDemo;</div><div class="line"><span class="keyword">import</span> my.client.ServerDemoService;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientDemo</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ServerDemoService server = <span class="keyword">new</span> ServerDemoService();</div><div class="line">		ServerDemo serverDemo = server.getServerDemoPort();</div><div class="line">		System.out.println(serverDemo.sayHi(<span class="string">"erver body"</span>));</div><div class="line">		System.out.println(serverDemo.doSth());</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行main方法之后，会输出“Hi: erver body,this is SOAPServer”与“do some thing”两句话，即说明调用成功，实现了远程调用。</p>
<h4 id="4-SOAP报文和WSDL文档简要解析。"><a href="#4-SOAP报文和WSDL文档简要解析。" class="headerlink" title="4. SOAP报文和WSDL文档简要解析。"></a>4. SOAP报文和WSDL文档简要解析。</h4><p>为了直观，我们先只分析调用sayHello.sayHi()时候的报文，在HelloClient 中注释掉sayHello.doSth()，然后发起请求，调用sayHi()方法。通过tcpTrace截获的SOAP请求报文如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">GET /SOAPServer/firstSoap?wsdl HTTP/1.1</div><div class="line">User-Agent: Java/1.8.0_60</div><div class="line">Host: localhost:8080</div><div class="line">Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</div><div class="line">Connection: keep-alive</div><div class="line"></div><div class="line">POST /SOAPServer/firstSoap HTTP/1.1</div><div class="line">Accept: text/xml, multipart/related</div><div class="line">Content-Type: text/xml; charset=utf-8</div><div class="line">SOAPAction: "http://demo/ServerDemo/sayHiRequest"</div><div class="line">User-Agent: JAX-WS RI 2.2.9-b130926.1035 svn-revision#5f6196f2b90e9460065a4c2f4e30e065b245e51e</div><div class="line">Host: localhost:8080</div><div class="line">Connection: keep-alive</div><div class="line">Content-Length: 187</div><div class="line"></div><div class="line"></div><div class="line">&lt;?xml version="1.0" ?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">S:Envelope</span>  <span class="attr">xmlns:S</span>=<span class="string">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">S:Body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ns2:sayHi</span> <span class="attr">xmlns:ns2</span>=<span class="string">"http://demo/"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">arg0</span>&gt;</span>erver body<span class="tag">&lt;/<span class="name">arg0</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ns2:sayHi</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">S:Body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">S:Envelope</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>通过tcpTrace截获的SOAP返回报文如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: Apache-Coyote/1.1</div><div class="line">Content-Type: text/xml;charset=utf-8</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Date: Sat, 29 Jul 2017 17:07:52 GMT</div><div class="line"></div><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="comment">&lt;!-- Published by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.10 svn-revision#919b322c92f13ad085a933e8dd6dd35d4947364b. --&gt;</span></div><div class="line"><span class="comment">&lt;!-- Generated by JAX-WS RI (http://jax-ws.java.net). RI's version is JAX-WS RI 2.2.10 svn-revision#919b322c92f13ad085a933e8dd6dd35d4947364b. --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">definitions</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsu</span>=<span class="string">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsp</span>=<span class="string">"http://www.w3.org/ns/ws-policy"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsp1_2</span>=<span class="string">"http://schemas.xmlsoap.org/ws/2004/09/policy"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:wsam</span>=<span class="string">"http://www.w3.org/2007/05/addressing/metadata"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:soap</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/soap/"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:tns</span>=<span class="string">"http://demo/"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://schemas.xmlsoap.org/wsdl/"</span> <span class="attr">targetNamespace</span>=<span class="string">"http://demo/"</span> <span class="attr">name</span>=<span class="string">"ServerDemoService"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">types</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xsd:schema</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xsd:import</span> <span class="attr">namespace</span>=<span class="string">"http://demo/"</span> <span class="attr">schemaLocation</span>=<span class="string">"http://localhost:8080/SOAPServer/firstSoap?xsd=1"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xsd:schema</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">types</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"doSthResponse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"sayHiResponse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:sayHiResponse"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">portType</span> <span class="attr">name</span>=<span class="string">"ServerDemo"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/doSthRequest"</span> <span class="attr">message</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/doSthResponse"</span> <span class="attr">message</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/sayHiRequest"</span> <span class="attr">message</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/sayHiResponse"</span> <span class="attr">message</span>=<span class="string">"tns:sayHiResponse"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">portType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">"ServerDemoPortBinding"</span> <span class="attr">type</span>=<span class="string">"tns:ServerDemo"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">soap:binding</span> <span class="attr">transport</span>=<span class="string">"http://schemas.xmlsoap.org/soap/http"</span> <span class="attr">style</span>=<span class="string">"document"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">binding</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"ServerDemoService"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">port</span> <span class="attr">name</span>=<span class="string">"ServerDemoPort"</span> <span class="attr">binding</span>=<span class="string">"tns:ServerDemoPortBinding"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:address</span> <span class="attr">location</span>=<span class="string">"http://localhost:8080/SOAPServer/firstSoap"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">port</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">service</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></div><div class="line"></div><div class="line">HTTP/1.1 200 OK</div><div class="line">Server: Apache-Coyote/1.1</div><div class="line">Content-Type: text/xml;charset=utf-8</div><div class="line">Transfer-Encoding: chunked</div><div class="line">Date: Sat, 29 Jul 2017 17:07:52 GMT</div><div class="line"></div><div class="line"></div><div class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">S:Envelope</span> <span class="attr">xmlns:S</span>=<span class="string">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">S:Body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ns2:sayHiResponse</span>  <span class="attr">xmlns:ns2</span>=<span class="string">"http://demo/"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">return</span>&gt;</span>Hi: erver body,this is SOAPServer<span class="tag">&lt;/<span class="name">return</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ns2:sayHiResponse</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">S:Body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">S:Envelope</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>从报文格式可以看出，明显的HTTP+XML格式，对于SOAP1.1和SOAP1.2相比，在HTTP格式的请求头里面会有些区别，主要是命名空间的区别。可以粗略参考<a href="http://blog.sina.com.cn/s/blog_5f044a4d0101gzli.html" target="_blank" rel="external">SOAP1.1和SOAP1.2报文差异</a>。从报文里面可以看出，虽然ClientDemo只调用sayHi()方法，但是请求有两段，第一个get请求，是请求返回的wsdl文档；第二个请求是post请求，才是真正调用sayHi()方法，并返回了结果。实际上，发起get请求去获得对应的wsdl文档这个动作，是在客户端创建ServerDemoService这个对象的时候发起的，也就是下面这行代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ServerDemoService server = <span class="keyword">new</span> ServerDemoService();</div></pre></td></tr></table></figure></p>
<p>显然，在soap中，wsdl文档至关重要，包含了服务端的所有调用信息。从结构上看，最顶层是definitions根节点，根节点下面分为以下几部分：</p>
<h5 id="types部分"><a href="#types部分" class="headerlink" title="types部分"></a>types部分</h5><p>从wsdl文档中可以看出，types节点指向了一个地址：“<a href="http://localhost:8080/SOAPServer/firstSoap?xsd=1”，而这个地址是一个schema文件（即一个描述XML格式的文件），该文件内容如下：" target="_blank" rel="external">http://localhost:8080/SOAPServer/firstSoap?xsd=1”，而这个地址是一个schema文件（即一个描述XML格式的文件），该文件内容如下：</a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">xs:schema</span> <span class="attr">version</span>=<span class="string">"1.0"</span> <span class="attr">targetNamespace</span>=<span class="string">"http://demo/"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"doSth"</span> <span class="attr">type</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"doSthResponse"</span> <span class="attr">type</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"sayHi"</span> <span class="attr">type</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"sayHiResponse"</span> <span class="attr">type</span>=<span class="string">"tns:sayHiResponse"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:complexType</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xs:sequence</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:complexType</span> <span class="attr">name</span>=<span class="string">"doSthResponse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"return"</span> <span class="attr">type</span>=<span class="string">"xs:string"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:complexType</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"arg0"</span> <span class="attr">type</span>=<span class="string">"xs:string"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:complexType</span> <span class="attr">name</span>=<span class="string">"sayHiResponse"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"return"</span> <span class="attr">type</span>=<span class="string">"xs:string"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:schema</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>文件里规定了元素名称、元素类型。以sayHi为例，<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"sayHi"</span> <span class="attr">type</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>说明了有一个元素名为sayHi，这个元素的类型是“tns:sayHi”，而“tns:sayHi”指向下面这段：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">xs:complexType</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"arg0"</span> <span class="attr">type</span>=<span class="string">"xs:string"</span> <span class="attr">minOccurs</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>说明sayHi是一个复杂类型，而这个复杂类型再包含了一个元素，元素名为arg0，arg0的类型是String类型（minOccurs表示这个元素“最小出现次数”）。<br>结合请求报文中的Body节点：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" ?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">S:Envelope</span>  <span class="attr">xmlns:S</span>=<span class="string">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">S:Body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ns2:sayHi</span> <span class="attr">xmlns:ns2</span>=<span class="string">"http://demo/"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">arg0</span>&gt;</span>erver body<span class="tag">&lt;/<span class="name">arg0</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ns2:sayHi</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">S:Body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">S:Envelope</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>可以看出，上面的type就是描述了请求报文和返回报文的节点名称、节点内容的类型。</p>
<h5 id="portType和message"><a href="#portType和message" class="headerlink" title="portType和message"></a>portType和message</h5><p>portType节点中主要包含若干个operation节点（每一个operation节点与服务方的方法对应）。operation节点中包括input和output，input在output之前，即是请求/响应模式。input和output都有一个message属性，这个message属性指向了相应的message节点。而这个message节点中又包含一个part，part的element属性指定了这个operation节点的输入值的参数名以及类型。简而言之，portType和message分别指定了这个服务拥有的方法，以及每个方法需要的参数和返回值的类型以及名称。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">portType</span> <span class="attr">name</span>=<span class="string">"ServerDemo"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/doSthRequest"</span> <span class="attr">message</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/doSthResponse"</span> <span class="attr">message</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/sayHiRequest"</span> <span class="attr">message</span>=<span class="string">"tns:sayHi"</span>/&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">output</span> <span class="attr">wsam:Action</span>=<span class="string">"http://demo/ServerDemo/sayHiResponse"</span> <span class="attr">message</span>=<span class="string">"tns:sayHiResponse"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">portType</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:doSth"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">message</span> <span class="attr">name</span>=<span class="string">"doSthResponse"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">part</span> <span class="attr">name</span>=<span class="string">"parameters"</span> <span class="attr">element</span>=<span class="string">"tns:doSthResponse"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">message</span>&gt;</span></div></pre></td></tr></table></figure>
<h5 id="binding"><a href="#binding" class="headerlink" title="binding"></a>binding</h5><p>transport的值 “<a href="http://schemas.xmlsoap.org/soap/http”" target="_blank" rel="external">http://schemas.xmlsoap.org/soap/http”</a> 可以概括为基于HTTP的SOAP，这个值还可以是其他的值，如SMTP、TCP。style为document，指定这个服务的style为document（意味着消息格式是XML格式或者等价的文档格式）。style还有一个选项是“rpc”，这个名称容易引起误解，这个值意味着消息本身不是类型化的（没有type部分），而use=”literal”是WSDL中定义的服务的类型遵循WSDL的模式，决定了数据类型被如何编码和解码。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">binding</span> <span class="attr">name</span>=<span class="string">"ServerDemoPortBinding"</span> <span class="attr">type</span>=<span class="string">"tns:ServerDemo"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">soap:binding</span> <span class="attr">transport</span>=<span class="string">"http://schemas.xmlsoap.org/soap/http"</span> <span class="attr">style</span>=<span class="string">"document"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"doSth"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">operation</span> <span class="attr">name</span>=<span class="string">"sayHi"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">soap:operation</span> <span class="attr">soapAction</span>=<span class="string">""</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">output</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">soap:body</span> <span class="attr">use</span>=<span class="string">"literal"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">output</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">operation</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">binding</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h5 id="service"><a href="#service" class="headerlink" title="service"></a>service</h5><p>以上的部分更多的是在指定服务的名称、类型等等规范。而service提供了服务的相关实现细节。service中包含port子元素（数量由binding部分的数量，因为明显看出port是指向相应的binding元素的），最重要的还是address子元素，指定了一个location，即发布服务的地址，通过解析这个地址进行调用。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">name</span>=<span class="string">"ServerDemoService"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">port</span> <span class="attr">name</span>=<span class="string">"ServerDemoPort"</span> <span class="attr">binding</span>=<span class="string">"tns:ServerDemoPortBinding"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">soap:address</span> <span class="attr">location</span>=<span class="string">"http://localhost:8080/SOAPServer/firstSoap"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">port</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>通过这个WSDL文档，描述了完整的服务信息。这些信息是可以在服务类里面通过注解进行配置的。例如@  SOAPBinding可以将binding部分的style属性由“document”更改为“rpc”。详细的配置本文就不深入了，因为现实中已经很少会使用这种JAX-WS实现，JAX-WS实现已经被其他的框架所扩展。下一篇文章将简单介绍基于SOAP的webservice的Axis2框架实现。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/14/maxSubArray/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/14/maxSubArray/" itemprop="url">
                  求一个数组中最大的子数组之和以及起终点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-14T18:25:22+08:00">
                2017-05-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>在LeetCode上做的一道题目，想了很久没有想出比较简便的方法，借鉴了网上的方法之后做了然后做个总结。</li>
</ul>
<h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p> Find the contiguous subarray within an array (containing at least one number) which has the largest sum.<br>For example, given the array [-2,1,-3,4,-1,2,1,-5,4],<br>the contiguous subarray [4,-1,2,1] has the largest sum = 6.<br>简单而言就是找出一个正负数都有的数组中最大的子数组之和。</p>
<h4 id="分析解答"><a href="#分析解答" class="headerlink" title="分析解答"></a>分析解答</h4><ol>
<li>看到这个题，首先想到的一个最简单但是时间复杂度最高的方法就是，把这个数组的所有子数组的和都求出来，一个一个比较，取最大值。<br>假设数组的长度为n，那么以它的每个元素的下标i（i从0开始）为子数组起点，都有n-i个子数组，所以所有的子数组个数是<br>n+n-1+n-2+n-3+…+4+3+2+1<br>=(n+1)+(n-1+2)+(n-2+3)+…<br>=(n/2)(n+1)<br>所以时间复杂度为O（n²）；</li>
<li>动态规划（复杂度为O(n)）。对于数组中第i个元素来说，设curSum为nums[i]之前的累加和最大值，如果这个最大值<0，那么加上nums[i]之后必然会使累加和变小。即cursum+nums[i]<nums[i]，所以此时应该丢掉之前的累加和，从nums[i]重新开始累加。反之，cursum+nums[i]>nums[i]，必定会使和变大（即便nums[i]为负数）。这样，每循环一个元素，都能保证去掉拖后腿的累加和。只要不拖后腿，能多加一个正数，肯定是有利于累加和的增大。从这些累加中比较出值大的累加和即可。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">public static int maxSubArray(int[] nums)&#123;</div><div class="line">		int curSum = nums[0];//curSum为nums[i]之前的累加和最大值</div><div class="line">		int maxSum = nums[0];//最大累加和</div><div class="line">		int curBegin = 0;//当前累加和起点</div><div class="line">		int maxBegin = 0;//最大累加和起点</div><div class="line">		int maxEnd = 0;//最大累加和终点</div><div class="line">		for(int i=1;i&lt;nums.length;i++)&#123;</div><div class="line">			if(curSum&gt;0)&#123;</div><div class="line">				//如果之前的累加和&gt;0，加上nums[i]元素</div><div class="line">				curSum += nums[i];</div><div class="line">			&#125;else&#123;</div><div class="line">				//否则，以nums[i]为起点重新开始</div><div class="line">				curSum = nums[i];</div><div class="line">				curBegin = i;</div><div class="line">			&#125;</div><div class="line">			//如果当前累加和&gt;记录的累加和，赋值。并将当前累加和的起终点记录下来</div><div class="line">			if(curSum &gt; maxSum)&#123;</div><div class="line">				maxSum = curSum;</div><div class="line">				maxBegin = curBegin;</div><div class="line">				maxEnd = i;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		System.out.println(&quot;起点:&quot;+maxBegin+&quot;,终点:&quot;+maxEnd);</div><div class="line">		return maxSum;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></0，那么加上nums[i]之后必然会使累加和变小。即cursum+nums[i]<nums[i]，所以此时应该丢掉之前的累加和，从nums[i]重新开始累加。反之，cursum+nums[i]></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/09/Springdingshiqi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/09/Springdingshiqi/" itemprop="url">
                  Java定时器，Spring定时器极其部署方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-09T23:02:35+08:00">
                2017-01-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>记录几种定时器的实现方式——仅仅在应用层面，简单的实现。本文在完成过程中参考了<a href="http://www.cnblogs.com/chenssy/p/3788407.html" target="_blank" rel="external">详解java定时任务</a>、<a href="http://gong1208.iteye.com/blog/1773177" target="_blank" rel="external">Spring定时任务的几种实现</a>等文章。</li>
</ul>
<hr>
<h3 id="实现定时器的几种方式"><a href="#实现定时器的几种方式" class="headerlink" title="实现定时器的几种方式"></a>实现定时器的几种方式</h3><ol>
<li>java.util.Timer与java.util.TimerTask。个人总结了一下，这种方式因为有一些缺陷，适合一些简单的定时任务。参考文章<a href="http://www.cnblogs.com/chenssy/p/3788407.html" target="_blank" rel="external">详解java定时任务</a>，非常详细。</li>
<li>Spring与Quartz的结合，配置比较麻烦，公司的老项目还在用这种方式。</li>
<li>Spring3.0以上版本自带的task，配置简单，新项目使用的这种方式。</li>
</ol>
<h3 id="两种部署方式（linux，项目使用spring的情况下）"><a href="#两种部署方式（linux，项目使用spring的情况下）" class="headerlink" title="两种部署方式（linux，项目使用spring的情况下）"></a>两种部署方式（linux，项目使用spring的情况下）</h3><ol>
<li>如果不是web工程，编写一个启动类，用于加载spring的配置文件启动spring容器，并编写启动java程序的脚本（参考<a href="http://www.cnblogs.com/duanxz/p/5581438.html" target="_blank" rel="external">不错的linux下通用的java程序启动脚本</a>）。</li>
<li>如果是web工程，将spring加进web.xml的监听器，随着web工程的启动而启动。</li>
</ol>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><h4 id="1-java-util-Timer与java-util-TimerTask简单实例。"><a href="#1-java-util-Timer与java-util-TimerTask简单实例。" class="headerlink" title="1. java.util.Timer与java.util.TimerTask简单实例。"></a>1. java.util.Timer与java.util.TimerTask简单实例。</h4><p>(1) 、创建任务类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">  <span class="keyword">package</span> org.my.timertask;</div><div class="line">  <span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line">  <span class="keyword">import</span> java.util.Date;</div><div class="line">  <span class="keyword">import</span> java.util.TimerTask;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * 创建任务类，继承TimerTask,重写其run方法，方法体指定要执行的任务。</span></div><div class="line"><span class="comment">   * <span class="doctag">@author</span> fasen</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerTaskDemo</span> <span class="keyword">extends</span> <span class="title">TimerTask</span></span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd hh:mm:ss"</span>);</div><div class="line">		System.out.println(<span class="string">"这是java.util.TimeTask在执行任务,本次执行时间是："</span>+sdf.format(<span class="keyword">new</span> Date()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>(2)、使用调度对象进行调用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">package</span> org.my.timertask;</div><div class="line"> <span class="keyword">import</span> java.util.Timer;</div><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimerDemo</span> </span>&#123;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	<span class="comment">//创建Timer对象，并调用schedule方法（有四个重载方法）</span></div><div class="line">	Timer t = <span class="keyword">new</span> Timer();</div><div class="line">	<span class="comment">//传递参数。第一个参数是TimerTask对象（指定要执行的任务）,第二个参数是延迟时间，第三个参数是时间间隔（毫秒）</span></div><div class="line">	t.schedule(<span class="keyword">new</span> TimerTaskDemo(),<span class="number">0</span>,<span class="number">5000</span>);</div><div class="line">&#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/7%60NPRRW5LO$@~YGF@B%5BMP7I.png" alt="运行结果"></p>
<h4 id="2-Spring与Quartz的结合使用"><a href="#2-Spring与Quartz的结合使用" class="headerlink" title="2. Spring与Quartz的结合使用"></a>2. Spring与Quartz的结合使用</h4><p> (1)、导入jar包：org.quartz-scheduler，我使用的是2.1.1。我用的Spring的版本是Spring4.0.2，如果使用quartz2.x与Spring3.1以上的版本，配置的bean类必须与本配置一致。根据Spring和quart的版本不同，会有不同的配置。quartz2.x与Spring3.1以上的版本将老版本很多类名加了Factory，比如将CronTriggerBean修改为CronTriggerFactoryBean、将JobDetailBean修改为JobDetailFactoryBean等等，如果用quartz2.x与Spring3.1以上的版本的jar，而使用低版本的配置——CronTriggerBean和JobDetailBean话，会出现类似以下的错误<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">org</span>.<span class="title">springframework</span>.<span class="title">scheduling</span>.<span class="title">quartz</span>.<span class="title">JobDetailBean</span> <span class="title">has</span> <span class="title">interface</span> <span class="title">org</span>.<span class="title">quartz</span>.<span class="title">JobDetail</span> <span class="title">as</span> <span class="title">super</span> <span class="title">class</span></span></div></pre></td></tr></table></figure></p>
<p>这个错误，即代表jar包版本和配置不一致。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span>  </div><div class="line">      <span class="comment">&lt;!-- spring版本号 --&gt;</span>  </div><div class="line">      <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.0.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span> </div><div class="line">      <span class="tag">&lt;<span class="name">failOnMissingWebXml</span>&gt;</span>false<span class="tag">&lt;/<span class="name">failOnMissingWebXml</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span> </div><div class="line"><span class="comment">&lt;!-- spring核心包 --&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"> <span class="comment">&lt;!-- spring核心包 --&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>(2)、编写任务类，Spring与Quartz的结合使用，其任务类有两种方式——任务类继承QuartzJobBean类、任务类不继承特定类。</p>
<blockquote>
<p>任务类继承QuartzJobBean类，需要重写executeInternal方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.my.SpringQuartz;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionContext;</div><div class="line"><span class="keyword">import</span> org.quartz.JobExecutionException;</div><div class="line"><span class="keyword">import</span> org.springframework.scheduling.quartz.QuartzJobBean;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringQuartzJob</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext arg0)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;	</div><div class="line">		SimpleDateFormat sdf  = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">		System.out.println(<span class="string">"这是SpringQuartzJob定时任务...任务类继承QuartzJobBean,当前时间："</span>+sdf.format(<span class="keyword">new</span> Date()));	</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>任务类不继承特定类，POJO，方法名自定义：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.my.SpringQuartz;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotExtendSpringQuartzJob</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dosomething</span><span class="params">()</span></span>&#123;</div><div class="line">		SimpleDateFormat sdf  = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">		System.out.println(<span class="string">"这是NotExtendSpringQuartzJob定时任务...任务类不继承特定类，是POJO,现在时间："</span>+sdf.format(<span class="keyword">new</span> Date()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p> (3)、spring配置：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context-4.0.xsd    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd"</span>&gt;</span>  </div><div class="line"><span class="comment">&lt;!-- 定时任务配置（任务类继承特定的类） 开头 --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 定时任务bean,任务执行类 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"springQuartzJob"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.JobDetailFactoryBean"</span> &gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobClass"</span> <span class="attr">value</span>=<span class="string">"org.my.SpringQuartz.SpringQuartzJob"</span> /&gt;</span>  </div><div class="line">		<span class="comment">&lt;!-- 任务类的属性map,可以设置参数，我这里没有属性 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- &lt;property name="jobDataAsMap"&gt;  </span></div><div class="line"><span class="comment">			&lt;map&gt;  </span></div><div class="line"><span class="comment">			&lt;entry key="timeout" value="0" /&gt;  </span></div><div class="line"><span class="comment">			&lt;/map&gt;  </span></div><div class="line"><span class="comment">		&lt;/property&gt;   --&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </div><div class="line">	<span class="comment">&lt;!-- 任务执行类对应的触发器：第一种（按照一定的时间间隔触发） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"springQuartzJobTrigger1"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SimpleTriggerFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"springQuartzJob"</span> /&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"startDelay"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span><span class="comment">&lt;!-- 调度工厂实例化后，经过0秒开始执行调度 --&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"repeatInterval"</span> <span class="attr">value</span>=<span class="string">"30000"</span> /&gt;</span><span class="comment">&lt;!-- 每30秒调度一次 --&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 任务执行类对应的触发器：第二种（按照指定时间触发，如每天12点） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"springQuartzJobTrigger2"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"springQuartzJob"</span> /&gt;</span>  </div><div class="line">		<span class="comment">&lt;!-- 每天21:37运行一次 --&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span> <span class="attr">value</span>=<span class="string">"0 37 21 * * ?"</span> /&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 调度工厂 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"triggers"</span>&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span>  </div><div class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"springQuartzJobTrigger1"</span> /&gt;</span>  </div><div class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"springQuartzJobTrigger2"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span>  </div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </div><div class="line"><span class="comment">&lt;!-- 定时任务配置（任务类继承特定的类） 结尾 --&gt;</span>	</div><div class="line"><span class="comment">&lt;!-- 定时任务配置（任务类不继承特定的类）开头 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 定时任务bean,任务执行类 --&gt;</span></div><div class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"notExtendSpringQuartzJob"</span>  <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetObject"</span>&gt;</span>  <span class="comment">&lt;!-- 指定任务类 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.my.SpringQuartz.NotExtendSpringQuartzJob"</span> /&gt;</span>  </div><div class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetMethod"</span> <span class="attr">value</span>=<span class="string">"dosomething"</span> /&gt;</span>  <span class="comment">&lt;!-- 制定任务类中的方法 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"concurrent"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span><span class="comment">&lt;!-- 作业不并发调度 --&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </div><div class="line">	<span class="comment">&lt;!-- 任务执行类对应的触发器：第一种（按照一定的时间间隔触发） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"notExtendSpringQuartzJobTrigger1"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SimpleTriggerFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"notExtendSpringQuartzJob"</span> /&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"startDelay"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span><span class="comment">&lt;!-- 调度工厂实例化后，经过0秒开始执行调度 --&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"repeatInterval"</span> <span class="attr">value</span>=<span class="string">"30000"</span> /&gt;</span><span class="comment">&lt;!-- 每30秒调度一次 --&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 任务执行类对应的触发器：第二种（按照指定时间触发，如每天12点） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"notExtendSpringQuartzJobTrigger2"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span> <span class="attr">ref</span>=<span class="string">"notExtendSpringQuartzJob"</span> /&gt;</span>  </div><div class="line">		<span class="comment">&lt;!-- 每天21:37运行一次 --&gt;</span>  </div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span> <span class="attr">value</span>=<span class="string">"0 37 21 * * ?"</span> /&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 调度工厂 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</span>  </div><div class="line">	    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"triggers"</span>&gt;</span>  </div><div class="line">	    <span class="tag">&lt;<span class="name">list</span>&gt;</span>  </div><div class="line">	   		<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"notExtendSpringQuartzJobTrigger1"</span> /&gt;</span>  </div><div class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"notExtendSpringQuartzJobTrigger2"</span> /&gt;</span>  </div><div class="line">	    <span class="tag">&lt;/<span class="name">list</span>&gt;</span>  </div><div class="line">	    <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 定时任务配置（任务类不继承特定的类）结尾 --&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>(4)、启动。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.my.SpringQuartz;</div><div class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</div><div class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartSpringQuartz</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);	</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>eclipse执行结果如下，红框外是根据指定时间间隔触发的——SimpleTriggerFactoryBean，红框内的是设定指定时间触发——CronTriggerFactoryBean，此处配置的是21:37分。<img src="http://7xrt1z.com1.z0.glb.clouddn.com/StartSpringQuartz.png" alt="执行结果">  </p>
<h4 id="3-Spring3-0以上版本自带的task。"><a href="#3-Spring3-0以上版本自带的task。" class="headerlink" title="3. Spring3.0以上版本自带的task。"></a>3. Spring3.0以上版本自带的task。</h4><p><strong>配置文件方式：</strong><br>(1)、编写任务类，POJO。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.my.SpringTask;</div><div class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line"><span class="keyword">import</span> java.util.Date;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskJob</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dosomething</span><span class="params">()</span></span>&#123;</div><div class="line">		SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">		System.out.println(<span class="string">"这是SpringTask定时任务，当前时间："</span>+sdf.format(<span class="keyword">new</span> Date()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>(2)、Spring配置（applicationContext-SpringTask.xml），在头部文件中加入了task声明。如果没有声明，会出现类似以下的异常<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">“org.xml.sax.SAXParseException; lineNumber: <span class="number">19</span>; columnNumber: <span class="number">24</span>; cvc-complex-type.2.4.c: 通配符的匹配很全面, 但无法找到元素 <span class="string">'task:scheduled-tasks'</span> 的声明。”</div></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>  </span></div><div class="line"><span class="tag">    <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></div><div class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context-4.0.xsd    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc    </span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/task</span></span></div><div class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/task/spring-task-4.0.xsd"</span>&gt;</span>  </div><div class="line">    <span class="comment">&lt;!-- 自动扫描(并启用注解)Spring-task定时方式可以用注解 --&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.my.SpringTask"</span> /&gt;</span>  </div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- Spring task定时配置 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">task:scheduled-tasks</span>&gt;</span>   </div><div class="line">		 <span class="comment">&lt;!-- 每15秒执行一次，此处可设置为以指定时间间隔或者指定的时间执行，具体由cron表达式决定 --&gt;</span></div><div class="line">	        <span class="tag">&lt;<span class="name">task:scheduled</span> <span class="attr">ref</span>=<span class="string">"taskJob"</span> <span class="attr">method</span>=<span class="string">"dosomething"</span> <span class="attr">cron</span>=<span class="string">"0/15 * * * * ?"</span>/&gt;</span>  </div><div class="line">	<span class="tag">&lt;/<span class="name">task:scheduled-tasks</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<p>(3)、启动<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.my.SpringTask;</div><div class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</div><div class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartSpringTask</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"></div><div class="line">		ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext-SpringTask.xml"</span>);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行结果：<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/SpringTask.png" alt="运行结果"><br><strong>注解方式：</strong><br>(1)、任务类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.my.SpringTaskComment;</div><div class="line"></div><div class="line">  <span class="keyword">import</span> java.text.SimpleDateFormat;</div><div class="line">  <span class="keyword">import</span> java.util.Date;</div><div class="line"></div><div class="line">  <span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</div><div class="line">  <span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line">  <span class="meta">@Component</span></div><div class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskJobComment</span> </span>&#123;</div><div class="line">	<span class="meta">@Scheduled</span>(cron=<span class="string">"0/15 * * * * ?"</span>)<span class="comment">//每15秒执行一次</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dosomething</span><span class="params">()</span></span>&#123;</div><div class="line">		SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">		System.out.println(<span class="string">"这是SpringTask定时任务注解版，当前时  间："</span>+sdf.format(<span class="keyword">new</span> Date()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>(2)、Spring开启注解扫描</p>
<pre><code class="html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>  </span>
<span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span>  </span>
<span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>  </span>
<span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>  </span>
<span class="tag">    <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span>
<span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans    </span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd    </span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/context    </span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context-4.0.xsd    </span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc    </span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/task</span></span>
<span class="tag"><span class="string">                        http://www.springframework.org/schema/task/spring-task-4.0.xsd"</span>&gt;</span>  
    <span class="comment">&lt;!-- 自动扫描(并启用注解)--&gt;</span>  
    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"org.my"</span> /&gt;</span>  
  <span class="comment">&lt;!-- 开启这个扫描才能使用定时注解，这个配置项有一些非必需参数（属性），比如executor、scheduler、mode等等--&gt;</span> 
     <span class="tag">&lt;<span class="name">task:annotation-driven</span>/&gt;</span>
<span class="tag">&lt;/<span class="name">beans</span>&gt;</span>
</code></pre>
<p>(3)、启动</p>
<pre><code class="java"><span class="keyword">package</span> org.my.SpringTaskComment;
 <span class="keyword">import</span> org.springframework.context.ApplicationContext;
 <span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
 <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartSpringTaskComment</span> </span>{
    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{        
        ApplicationContext ctx = <span class="keyword">new</span>  ClassPathXmlApplicationContext(<span class="string">"applicationContext-SpringTask.xml"</span>);
    }
}
</code></pre>
<p>执行结果：<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/SpringTaskComment.png" alt="执行结果"></p>
<p>至此，三种定时方式简单实现了一遍，更多的配置参数，以及效率、性能在此未作深入研究。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/24/weixin_jieshoubinghuifuwenbenxiaoxi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/24/weixin_jieshoubinghuifuwenbenxiaoxi/" itemprop="url">
                  微信Java开发系列 二、接收并回复文本消息
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-24T19:42:06+08:00">
                2016-12-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>声明：本文的操作过程参考了很多网络资源，但由于记录时已记不清参考的哪些资源，因此无法贴出。</li>
<li>因为业务需求，学习微信开发，网上很多资源对我来说可能不够细节，于是我把我做过的和想到的有用的东西记录于此，可能有些内容比较啰嗦，但希望能对刚开始微信开发的朋友们有参考作用，感谢每一位点击的朋友，我们一起进步。</li>
</ul>
<hr>
<h2 id="功能简介"><a href="#功能简介" class="headerlink" title="功能简介"></a>功能简介</h2><ul>
<li>被动回复消息功能，即用户向公众号发送消息，公众号进行自动回复的功能。实际的过程是用户发送消息到微信，微信服务器接收之后，由于我们配置并认证了自己的服务器，于是微信会发送一个请求到我们配置的服务器上，同时会以XML格式传递一系列参数，开发者通过解析XML来获取用户的消息内容。然后需要以<a href="https://mp.weixin.qq.com/wiki" target="_blank" rel="external">微信开发者文档</a>规定的格式构造并发送回复内容到微信服务器。</li>
<li>这里需要说明的是，用户给公众号发送的消息会有很多种类型，目前微信公众号支持的消息类型有：文本消息、图片消息、语音消息、视频消息、小视频消息、地理位置消息、链接消息。对于不同的消息类型，微信服务器发送给我们的对应的XML数据包的格式会略有不同。</li>
<li>同样，我们被动回复给用户也可以回复不同类型的消息，针对不同的消息需要构造的XML数据包的格式也有所不同。</li>
<li>更多详情请见<a href="https://mp.weixin.qq.com/wiki" target="_blank" rel="external">微信开发者文档</a>→消息管理。</li>
</ul>
<h2 id="开始开发"><a href="#开始开发" class="headerlink" title="开始开发"></a>开始开发</h2><ul>
<li>我的上一篇文章<a href="http://www.jianshu.com/p/7deaddd39a92" target="_blank" rel="external">微信java开发系列 一、认证成为开发者</a>中是写了一个servlet来接收微信服务器发送给我们的消息，并将其访问路径配置为微信公众号中的服务器配置的URL参数。在本文的接收消息的时候，我们依旧需要这个URL参数。认证成为开发者之后，在以后的接收消息的时候就不再需要认证了，我们可以选择将那一个servlet的路径注释掉，或者干脆将其中的代码挪至其他地方保存。</li>
<li>这里我们新建一个servlet，其访问路径就是我们在微信公众号中配置的URL。首先以接收文字消息以及回复文字消息为例。其XML数据包格式如下：<br><img src="http://upload-images.jianshu.io/upload_images/3727888-e8c4c013bdf9db9d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="接收到的文本消息的XML数据包格式"></li>
</ul>
<ol>
<li><p>我们首先需要做的是解析XML，为了流程清晰，这里简单的封装一下，把解析XML数据包封装成一个方法（工具类WeixinUtils）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 解析微信请求并读取XML</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span></span></div><div class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></div><div class="line"><span class="comment"> * <span class="doctag">@throws</span> DocumentException</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,String&gt; <span class="title">readWeixinXml</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> IOException, DocumentException</span>&#123;</div><div class="line">	Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</div><div class="line">	<span class="comment">//获取输入流</span></div><div class="line">	InputStream input = request.getInputStream();</div><div class="line">	<span class="comment">//使用dom4j的SAXReader读取（org.dom4j.io.SAXReader;）</span></div><div class="line">	SAXReader sax = <span class="keyword">new</span> SAXReader();</div><div class="line">	Document doc = sax.read(input);</div><div class="line">	<span class="comment">//获取XML数据包根元素</span></div><div class="line">	Element root = doc.getRootElement();</div><div class="line">	<span class="comment">//得到根元素的所有子节点</span></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">	List&lt;Element&gt; elementList = root.elements();</div><div class="line">	<span class="comment">//遍历所有节点并将其放进map</span></div><div class="line">	<span class="keyword">for</span>(Element e : elementList)&#123;</div><div class="line">		map.put(e.getName(), e.getText());</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//释放资源</span></div><div class="line">	input.close();</div><div class="line">	input = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">return</span> map;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>获取内容并回复文本内容。</p>
<pre><code class="java"><span class="keyword">package</span> my.controller;
<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.io.PrintWriter;
<span class="keyword">import</span> java.util.Map;
<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="keyword">import</span> org.apache.log4j.Logger;
<span class="keyword">import</span> org.dom4j.DocumentException;
<span class="keyword">import</span> org.springframework.stereotype.Controller;
<span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="keyword">import</span> my.Util.WeixinUtils;
<span class="meta">@Controller</span>
<span class="meta">@RequestMapping</span>(<span class="string">"/weixin"</span>)
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeixinMessage</span> </span>{
 <span class="keyword">private</span> Logger log = Logger.getLogger(WeixinMessage.class);
 <span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)
 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">replyTextMessage</span><span class="params">(HttpServletRequest request,HttpServletResponse response)</span></span>{
     Map&lt;String,String&gt; map = <span class="keyword">null</span>;
     <span class="comment">//从工具类中获取XML解析之后的map</span>
     <span class="keyword">try</span> {
         map =  WeixinUtils.readWeixinXml(request);
     } <span class="keyword">catch</span> (IOException e) {
         log.error(<span class="string">"获取输入流失败"</span>, e);
     } <span class="keyword">catch</span> (DocumentException e) {
         log.error(<span class="string">"读取XML失败"</span>, e);
     }
     <span class="comment">//获取发送方账号</span>
     String fromUserName = map.get(<span class="string">"FromUserName"</span>);
     <span class="comment">//接收方账号(开发者微信号)</span>
     String toUserName = map.get(<span class="string">"ToUserName"</span>);
     <span class="comment">//消息类型</span>
     String msgType = map.get(<span class="string">"MsgType"</span>);
     <span class="comment">//文本内容</span>
     String content = map.get(<span class="string">"Content"</span>);
     log.info(<span class="string">"发送方账号:"</span>+fromUserName+<span class="string">",接收方账号(开发者微信号):"</span>+toUserName+<span class="string">",消息类型:"</span>+msgType+<span class="string">",文本内容:"</span>+content);
     <span class="comment">//回复消息</span>
     <span class="keyword">if</span>(msgType.equals(<span class="string">"text"</span>)){
         <span class="comment">//根据开发文档要求构造XML字符串，本文为了让流程更加清晰，直接拼接</span>
         <span class="comment">//这里在开发的时候可以优化，将回复的文本内容构造成一个java类</span>
         <span class="comment">//然后使用XStream(com.thoughtworks.xstream.XStream)将java类转换成XML字符串，后面将会使用这个方法。</span>
         <span class="comment">//而且由于参数中没有任何特殊字符，为简单起见，没有添加&lt;![CDATA[xxxxx]]&gt;</span>
         String replyMsg = <span class="string">"&lt;xml&gt;"</span>+
                             <span class="string">"&lt;ToUserName&gt;"</span>+fromUserName+<span class="string">"&lt;/ToUserName&gt;"</span>+
                             <span class="string">"&lt;FromUserName&gt;"</span>+toUserName+<span class="string">"&lt;/FromUserName&gt;"</span>+
                             <span class="string">"&lt;CreateTime&gt;"</span>+System.currentTimeMillis()/<span class="number">1000</span>+<span class="string">"&lt;/CreateTime&gt;"</span>+
                             <span class="string">"&lt;MsgType&gt;"</span>+msgType+<span class="string">"&lt;/MsgType&gt;"</span>+
                             <span class="string">"&lt;Content&gt;"</span>+content+<span class="string">"&lt;/Content&gt;"</span>+
                          <span class="string">"&lt;/xml&gt;"</span>;
         <span class="comment">//响应消息</span>
         log.info(<span class="string">"响应消息："</span>+replyMsg);
         PrintWriter out = <span class="keyword">null</span>;
         <span class="keyword">try</span> {
             <span class="comment">//设置回复内容编码方式为UTF-8，防止乱码</span>
             response.setCharacterEncoding(<span class="string">"UTF-8"</span>);
             out = response.getWriter();
             <span class="comment">//我们这里将用户发送的消息原样返回</span>
             out.print(replyMsg);
             log.info(<span class="string">"==============响应成功=================="</span>);
         } <span class="keyword">catch</span> (IOException e) {
             log.error(<span class="string">"获取输出流失败"</span>,e);
         }<span class="keyword">finally</span> {
             <span class="keyword">if</span>(out != <span class="keyword">null</span>){
                 out.close();
                 out = <span class="keyword">null</span>;
             }
         }
     }
 }
}
</code></pre>
</li>
<li>打包，部署，向自己的测试号发送消息，可看到如下：</li>
</ol>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-e153db10dccb31fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="接收并回复文本消息"><br><img src="http://upload-images.jianshu.io/upload_images/3727888-99c607195c17fd29.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tomcat后台记录"></p>
<ul>
<li>到此，接收消息回复消息的功能就完成了，本文只是记录大概的后台流程，并没有涉及过多的细节，我们如果要回复其他类型的消息，只需要构造其他类型的XML字符串即可，需要注意的是<strong>“图片消息”和“图文消息”两者对应的XML格式不同</strong>。另外，本文没有排除重复消息，所以没有使用MsgId这个参数，如果两次消息的MsgId一样，那么就是重复发送的同一条消息。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/21/weixin_chengweikaifazhe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/21/weixin_chengweikaifazhe/" itemprop="url">
                  微信java开发系列 一、认证成为开发者
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-21T18:13:52+08:00">
                2016-12-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>声明：本文的操作过程参考了很多网络资源，但由于记录时已失去链接，因此无法贴出。</li>
<li>因为业务需求，学习微信开发，网上很多资源对我来说可能不够细节，于是我把我做过的和想到的有用的东西记录于此，希望能对刚开始微信开发的朋友们有参考作用。</li>
</ul>
<hr>
<ul>
<li>微信双向认证的过程就是两台服务器打招呼的过程，就好像我们接下来要一起做事，那么我们需要首先打个招呼，彼此知道对方在哪里一样。</li>
</ul>
<h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><ol>
<li><strong>需要一个自己的服务器资源和域名。</strong>我是搭建“科学上网”环境的时候自己买的一个VPS，并在上面搭建的nginx和tomcat，相关教程网络上资源很多。如果个人没有服务器资源的话，可以使用像BAE这类的应用引擎，相关资源请百度或者谷歌一下，本文默认您拥有自己的服务器资源并且已经搭建好web服务环境。 </li>
<li><strong>登录微信公众平台并注册账号，申请一个订阅号或者服务号。</strong>个人只能选择订阅号，订阅号和服务号的区别是服务号拥有更多的接口调用权限。如果你拥有申请服务号的资格，那么直接申请服务号即可。如果你只是自己学习开发，那么就申请订阅号，我们可以在自己的订阅号里面申请一个测试号，测试号拥有全部的接口调用权限，完全可以满足开发者学习。本文默认申请的是订阅号。</li>
</ol>
<h2 id="二、认证成为开发者"><a href="#二、认证成为开发者" class="headerlink" title="二、认证成为开发者"></a>二、认证成为开发者</h2><h4 id="一-、了解相关参数以及申请测试号"><a href="#一-、了解相关参数以及申请测试号" class="headerlink" title="(一)、了解相关参数以及申请测试号"></a>(一)、了解相关参数以及申请测试号</h4><ul>
<li><strong>熟悉微信开发配置参数</strong>。注册并申请订阅号之后，进入个人页面，选择开发→基本配置，可以看到相关配置。<ol>
<li>开发者ID（包括AppID和AppSecret）。这里简单说一下这两个参数，调用微信接口的时候需要使用这两个参数获取一个access_token，有了这个access_token，相当于我们才拥有了使用微信接口的权限。我们每次调用微信接口都需要传过去我们的access_token以供微信服务器验证。</li>
<li>除了开发者ID以外，我们还能看见服务器配置选项，点击修改配置，会进入填写自己的服务器信息界面。有三个参数：<ul>
<li>URL——你的服务器上接收微信消息的Servlet的路径（到方法）。相当于Struts2的Action路径（到方法），相当于SpringMVC的Controller的路径（到方法）。比如我使用的SpringMVC，URL是<a href="http://www.xxxx.com/web工程名/weixin/test.do" target="_blank" rel="external">http://www.xxxx.com/web工程名/weixin/test.do</a> ，这里还有一点是URL可以以http和https开头，分别支持80端口和443端口。如果使用的是http开头，那么你的服务器上面的web服务端口应该是80。如果以https开头，那么你的服务器上面的web服务端口应该是443。</li>
<li>Token——用于验证的参数。由用户自定义。</li>
<li>EncodingAESKey——用于加解密的字符串，如果我们选择EncodingAESKey参数下方的消息加解密方式为安全模式，那么我们接收到的微信发送过来的消息是经过加密的，同时我们发送给微信服务器的消息也应该加密，加解密的示例在<a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419318479&amp;token=&amp;lang=zh_CN" target="_blank" rel="external">微信开放平台的资源中心</a>有源代码可供下载（包括c++, php, java, python, c# 5种语言的示例代码）。</li>
</ul>
</li>
</ol>
</li>
<li><strong>申请测试号</strong>，为了拥有全部接口调用权限，我们可以申请一个测试号。在微信公众平台的个人页面选择开发下面的开发者工具，选择公众平台测试账号，进入申请测试号的管理页面之后，我们可以看到同样有appID和appsecret，同时也有接口配置信息，这些参数和上文提到的同名参数作用是一致的，即测试号也是一个公众号，只不过测试号有最多允许100个用户关注，以及名字无法自定义等限制，而且没有消息加解密功能。如下图：<br><img src="http://upload-images.jianshu.io/upload_images/3727888-61634847ea907b3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="测试号管理界面"></li>
</ul>
<h4 id="二-、双向认证"><a href="#二-、双向认证" class="headerlink" title="(二)、双向认证"></a>(二)、双向认证</h4><ul>
<li>啰嗦了半天，终于可以步入正题了。我们需要完成双向认证才能进行开发，此处相当于微信服务器需要发送一条消息在我们自己的服务器上，我们自己的服务器接收消息之后，首先确认这条消息是否是微信发送（这相当于我们自己的服务器验证微信，当然其实如果仅仅是想要微信服务器认证我们——单向认证，也可以不需要这一步），如果是，我们再原样返回微信发送的echostr参数（随机字符串），这样微信服务器接收消息之后，就认证了我这台服务器。  双向认证完成，就可以开始开发了。 </li>
<li>为此，我们需要创建一个web工程写一个Servlet服务接收微信服务器的请求，如果使用框架，即是SpringMVC的Controller，Struts2的Action，我使用的是SpringMVC，为了便于熟悉流程，将所有用到的东西都放在一个类中。没有进行分解，封装工具类等等，本文使用的是JDK1.8，注释详细，基本都能看懂。</li>
</ul>
<p>代码会说话：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">package my.controller;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import java.io.PrintWriter;</div><div class="line">import java.security.MessageDigest;</div><div class="line">import java.security.NoSuchAlgorithmException;</div><div class="line">import java.util.Arrays;</div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.http.HttpServletResponse;</div><div class="line">import org.apache.log4j.Logger;</div><div class="line">import org.springframework.stereotype.Controller;</div><div class="line">import org.springframework.web.bind.annotation.RequestMapping;</div><div class="line">@Controller</div><div class="line">@RequestMapping(&quot;/weixin&quot;)</div><div class="line">public class GetWeixinController &#123;</div><div class="line">	</div><div class="line">	private static Logger logger = Logger.getLogger(GetWeixinController.class);</div><div class="line">	</div><div class="line">	@RequestMapping(&quot;/test&quot;)</div><div class="line">	public void connect(HttpServletRequest request,HttpServletResponse response)&#123;</div><div class="line">		logger.info(&quot;接入成功&quot;);</div><div class="line">		String token = &quot;lifasen&quot;;//在开发者的测试号管理页面填写的token</div><div class="line">		</div><div class="line">		//获取请求中的参数，由于测试号没有加解密功能，所以此处并不需要解密，直接获取</div><div class="line">		String timestamp = request.getParameter(&quot;timestamp&quot;);</div><div class="line">		String nonce = request.getParameter(&quot;nonce&quot;);</div><div class="line">		String weixinSignature = request.getParameter(&quot;signature&quot;);</div><div class="line">		String echostr = request.getParameter(&quot;echostr&quot;);</div><div class="line">		logger.info(&quot;参数：token:&quot;+token+&quot;,timestamp:&quot;+timestamp+&quot;,nonce:&quot;+nonce+&quot;,signature:&quot;+weixinSignature);</div><div class="line">		</div><div class="line">		//对参数进行字典序排序</div><div class="line">		String[] para = &#123;token,timestamp,nonce&#125;;</div><div class="line">		Arrays.sort(para);</div><div class="line">		</div><div class="line">		//排序之后转换成字符串</div><div class="line">		String paraString = &quot;&quot;;</div><div class="line">		for(int i=0;i&lt;para.length;i++)&#123;</div><div class="line">			paraString += para[i];</div><div class="line">		&#125;</div><div class="line">		logger.info(&quot;排序结果：&quot;+paraString);</div><div class="line">		</div><div class="line">		//sha1加密工具(java.security.MessageDigest)</div><div class="line">		MessageDigest messageDigest = null;	</div><div class="line">		try &#123;</div><div class="line">			//获取加密工具对象</div><div class="line">			messageDigest = MessageDigest.getInstance(&quot;SHA-1&quot;);</div><div class="line">			//加密并转换为16进制字符串，byteToStr方法详细内容见下方</div><div class="line">			String mySignature = byteToStr(messageDigest.digest(paraString.getBytes()));</div><div class="line">			if(mySignature.equals(weixinSignature.toUpperCase()))&#123;</div><div class="line">				logger.info(&quot;==========验证成功============&quot;);</div><div class="line">				//原样返回微信服务器发送的echostr参数，同样，不需要加密</div><div class="line">				PrintWriter out = response.getWriter();</div><div class="line">				out.print(echostr);</div><div class="line">				logger.info(&quot;==========写出返回值成功============&quot;);</div><div class="line">			&#125;</div><div class="line">		&#125; catch (IOException e) &#123;</div><div class="line">			logger.error(&quot;获取输出流失败&quot;, e);</div><div class="line">		&#125; catch (NoSuchAlgorithmException e) &#123;</div><div class="line">			logger.error(&quot;获取加密工具对象失败&quot;,e);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	/**</div><div class="line">	 * 将字节转换为十六进制字符串 </div><div class="line">	 * @param mByte</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	private static String byteToHexStr(byte mByte) &#123;  </div><div class="line">        char[] Digit = &#123; &apos;0&apos;, &apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;D&apos;, &apos;E&apos;, &apos;F&apos; &#125;;  </div><div class="line">        char[] tempArr = new char[2];  </div><div class="line">        tempArr[0] = Digit[(mByte &gt;&gt;&gt; 4) &amp; 0X0F];  </div><div class="line">        tempArr[1] = Digit[mByte &amp; 0X0F];  </div><div class="line">        String s = new String(tempArr);  </div><div class="line">        return s;  </div><div class="line"></div><div class="line">    &#125;  </div><div class="line">	/**</div><div class="line">	 * 将字节数组转换为十六进制字符串</div><div class="line">	 * @param byteArray</div><div class="line">	 * @return</div><div class="line">	 */</div><div class="line">	private static String byteToStr(byte[] byteArray) &#123;  </div><div class="line"></div><div class="line">	        String strDigest = &quot;&quot;;  </div><div class="line">	        for (int i = 0; i &lt; byteArray.length; i++) &#123;  </div><div class="line">	            strDigest += byteToHexStr(byteArray[i]);  </div><div class="line">	        &#125;  </div><div class="line">	        return strDigest;  </div><div class="line"></div><div class="line">	    &#125;  </div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>至此，将工程打包，部署，在我们的服务器上启动tomcat，然后在测试号管理界面填写并点击提交，可以看见测试号管理界面提示配置成功，此时我们的服务器和微信服务器的双向认证成功，可以开始开发了。</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/3727888-3beee7a6e7b2d8d2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="测试号管理界面"><br><img src="http://upload-images.jianshu.io/upload_images/3727888-3735133eb7e31b18.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="tomcat后台"></p>
<ul>
<li>如果配置失败，请详细查看tomcat错误日志，排查错误，比如访问路径不对等等。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/06/my-new-post/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/06/my-new-post/" itemprop="url">
                  maven项目导入实践：打war包与私服搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-06T17:30:32+08:00">
                2016-03-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="动机："><a href="#动机：" class="headerlink" title="动机："></a>动机：</h3><pre><code>1、新手上路，想把公司的maven项目导入到家里另一台不能连公司私服的电脑上。
2、想了解公司使用的nexus私服，于是尝试了搭建过程。
</code></pre><h3 id="所用环境："><a href="#所用环境：" class="headerlink" title="所用环境："></a>所用环境：</h3><pre><code>本文所用eclipse为mars1版本，并配置了最新maven 3.3.9版本插件，Win10系统。
</code></pre><h3 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h3><pre><code>将公司的maven项目导入家里电脑上有两种方式：
1、将公司的项目打成war包然后导入即可，方式简单，但是每次都要copy大量的jar包。
2、在家里电脑上搭建nexus私服，首次部署需要将公司电脑里面的maven的仓库repository文件夹连同项目一起copy。
</code></pre><h3 id="方式1-打war包步骤："><a href="#方式1-打war包步骤：" class="headerlink" title="方式1 打war包步骤："></a>方式1 打war包步骤：</h3><pre><code>(1)、在eclipse项目上右键选择run as，选择Maven build...
</code></pre><p><img src="http://7xrt1z.com1.z0.glb.clouddn.com/mavenwarStep1.png" alt=""><br>    (2)、输入clean package命令，点击run。<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/mavenwarStep2.jpg" alt=""><br>    (3)、在eclipse的工作区间中，项目文件夹下的target文件夹下会生成-项目名.war文件，复制这个文件。<br>    (4)、在家里eclipse上导入war包，file→import→war file→Browse选择war包所在位置即可。</p>
<h3 id="方式2-nexus私服搭建步骤："><a href="#方式2-nexus私服搭建步骤：" class="headerlink" title="方式2 nexus私服搭建步骤："></a>方式2 nexus私服搭建步骤：</h3><pre><code>(1)首先从http://www.sonatype.org/nexus/下载最新版本的nexus，国外的网站可能访问速度会比较慢。
分别有Bundle包和war包两种格式，Bundle包自带了Jetty容器，因此用户不需要额外的web容器就可以
直接启动nexus，war包格式则需要部署到额外的web容器，该war包支持主流的web容器如Tomcat、Jetty、
Glassfish、Resin。本文下载的是最新nexus-2.12.0-01版本的bundle包(windows系统)。下载之后解
压文件得到两个子目录：
</code></pre><p><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexusstep1.png" alt=""><br>    <strong>nexus-2.12.0-01</strong>目录包含了nexus运行所需要的文件。<strong>sonatype-work</strong>目录包含nexus生成的配置文件，该目录不是必须的，nexus在运行的时候会动态创建该目录，但是它的内容包含了用户自己的配置和仓库内容。<br>    (2)在jsw文件夹下有很多文件夹，存放着各个系统的批处理文件，我这里选择Windows64位，进入后依次运行<strong>console-nexus.bat</strong>→<strong>install-nexus.bat</strong>→<strong>start-nexus.bat</strong>。<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexusstep2.png" alt=""><br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexusstep3.png" alt=""><br>    (3)完成后用浏览器访问  <a href="http://127.0.0.1:8081/nexus" target="_blank" rel="external">http://127.0.0.1:8081/nexus</a>  有如下界面即成功，点击右上角登录，用户名为admin，密码为admin123。ps：8081是默认的端口号，进入nexus-2.12.0-01\conf\打开nexus.properties文件，修改application-port属性值即可修改端口号。<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexusstep4.png" alt=""><br>    (4)登录后，点击左侧的Repositories可以浏览现有仓库，这个列表包含了所有类型的nexus仓库，仓库有四种类型：group(仓库组)、host(宿主)、proxy(代理)和virtual(虚拟)。每个仓库的格式为maven2或者maven1。属性Policy表示该仓库为发布(release)版本还是快照(snapshot)版本，最后两列为仓库的状态和路径。<br>    各个仓库的简要介绍如下：<br>          Public Repositories:  仓库组<br>          3rd party: 无法从公共仓库获得的第三方发布版本的构件仓库<br>          Apache Snapshots: 用了代理ApacheMaven仓库快照版本的构件仓库<br>          Central: 用来代理maven中央仓库中发布版本构件的仓库<br>          Central M1 shadow: 用于提供中央仓库中M1格式的发布版本的构件镜像仓库<br>          Codehaus Snapshots: 用来代理CodehausMaven 仓库的快照版本构件的仓库<br>          Releases: 用来部署管理内部的发布版本构件的宿主类型仓库<br>          Snapshots:用来部署管理内部的快照版本构件的宿主类型仓库<br>    各个类型的仓库之间的联系如下图所示(本图来自《maven实战》)：<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexusrelation.jpg" alt=""><br>    maven可以直接从宿主仓库下载构件，也可以从代理仓库下载构件，而代理仓库会间接从远程仓库下载并缓存构件。为了方便，maven可以从仓库组下载构件，而仓库组没有实际内容，它会转向其包含的宿主仓库或代理仓库获得实际构件的内容。</p>
<pre><code>点击此页菜单栏上的Add按钮会出现下图所示，可以分别添加四种仓库。
</code></pre><p><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexusadd.png" alt=""><br>    例如选择Hosted Repository可以添加宿主仓库，仓库列表下方会出现如下配置：<br><img src="http://7xrt1z.com1.z0.glb.clouddn.com/nexushost.png" alt=""><br>    点击save后会在仓库列表中看到刚刚新增的仓库。由于是个人使用，我只创建了一个宿主仓库。创建其他类型的仓库详见《maven实战》第9章。<br>    (5)配置maven从nexus下载构件。<br>    此处有两种方式，第一种是在项目的pom中配置nexus仓库，但是只对maven项目有效。第二种是profile机制配置到setting.xml中，可以让本机所有的maven项目都使用自己的maven私服。<br>    未完待续。。。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/05/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiake">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xiake">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/05/hello-world/" itemprop="url">
                  第一个hahahahhaha
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-05T20:50:15+08:00">
                2016-03-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xrt1z.com1.z0.glb.clouddn.com/katongtouxiang.PNG"
               alt="xiake" />
          <p class="site-author-name" itemprop="name">xiake</p>
           
              <p class="site-description motion-element" itemprop="description">just some note</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiake</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
